<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.24" /><meta name="theme" content="VuePress Theme Plume 1.0.0-rc.157" /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"service原理","image":[""],"dateModified":"2025-08-13T15:11:46.000Z","author":[]}</script><meta property="og:url" content="https://blog.jianzhihao.icu/k8s/hreo17tb/"><meta property="og:site_name" content="ZH Blog"><meta property="og:title" content="service原理"><meta property="og:description" content="一、Kubernetes Service 概述 Kubernetes Service 是 Kubernetes 系统中的核心抽象概念之一，它为运行在集群中的应用程序提供稳定的网络端点。Service 解决了 Pod 动态特性带来的网络连接问题： Pod 动态性挑战： Pod 是临时的，可能随时被创建或销毁 Pod IP 会随着重启或迁移而变化 部署规模..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-08-13T15:11:46.000Z"><meta property="article:modified_time" content="2025-08-13T15:11:46.000Z"><link rel="icon" type="image/png" href="https://theme-plume.vuejs.press/favicon-32x32.png"><title>service原理 | ZH Blog</title><meta name="description" content="一、Kubernetes Service 概述 Kubernetes Service 是 Kubernetes 系统中的核心抽象概念之一，它为运行在集群中的应用程序提供稳定的网络端点。Service 解决了 Pod 动态特性带来的网络连接问题： Pod 动态性挑战： Pod 是临时的，可能随时被创建或销毁 Pod IP 会随着重启或迁移而变化 部署规模..."><link rel="preload" href="/assets/style-D3gcUh-r.css" as="style"><link rel="stylesheet" href="/assets/style-D3gcUh-r.css"><link rel="modulepreload" href="/assets/app-Bx6_S8_t.js"><link rel="modulepreload" href="/assets/index.html-DXfVIarp.js"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-d90a7a26><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-d5a8d0bc></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-d5a8d0bc> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-d90a7a26 data-v-e98a6132><div class="vp-navbar" vp-navbar data-v-e98a6132 data-v-2c31ea5e><div class="wrapper" data-v-2c31ea5e><div class="container" data-v-2c31ea5e><div class="title" data-v-2c31ea5e><div class="vp-navbar-title has-sidebar" data-v-2c31ea5e data-v-1a4f50af><a class="vp-link link no-icon title" href="/" data-v-1a4f50af><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" style="" src="https://theme-plume.vuejs.press/plume.png" alt data-v-480e858a><!--]--><!--[--><img class="vp-image light logo" style="" src="https://theme-plume.vuejs.press/plume.png" alt data-v-480e858a><!--]--><!--]--><!--]--><span data-v-1a4f50af>ZH Blog</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-2c31ea5e><div class="content-body" data-v-2c31ea5e><!--[--><!--]--><div class="vp-navbar-search search" data-v-2c31ea5e><div class="search-wrapper" data-v-97535d1e><!----><div id="local-search" data-v-97535d1e><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-97535d1e><span class="mini-search-button-container"><span class="mini-search-search-icon vpi-mini-search" aria-label="search icon"></span><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><!--[--><!--]--><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-2c31ea5e data-v-d43c1732><span id="main-nav-aria-label" class="visually-hidden" data-v-d43c1732>Main Navigation</span><!--[--><!--[--><a class="vp-link link navbar-menu-link" href="/" tabindex="0" data-v-d43c1732 data-v-d4acf911><!--[--><!----><span data-v-d4acf911>🏡首页</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/blog/" tabindex="0" data-v-d43c1732 data-v-d4acf911><!--[--><!----><span data-v-d4acf911>📝博客</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/blog/tags/" tabindex="0" data-v-d43c1732 data-v-d4acf911><!--[--><!----><span data-v-d4acf911>🔖标签</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/blog/archives/" tabindex="0" data-v-d43c1732 data-v-d4acf911><!--[--><!----><span data-v-d4acf911>🗃️归档</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/blog/categories/" tabindex="0" data-v-d43c1732 data-v-d4acf911><!--[--><!----><span data-v-d4acf911>🕹️分类</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/notes/" tabindex="0" data-v-d43c1732 data-v-d4acf911><!--[--><!----><span data-v-d4acf911>📚笔记</span><!----><!--]--><!----></a><!--]--><!--[--><a class="vp-link link navbar-menu-link" href="/travel/" tabindex="0" data-v-d43c1732 data-v-d4acf911><!--[--><!----><span data-v-d4acf911>🏖️旅行</span><!----><!--]--><!----></a><!--]--><!--]--></nav><!--[--><!--]--><div class="vp-flyout vp-navbar-translations translations" data-v-2c31ea5e data-v-0d45479b data-v-86530b6c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="选择语言" data-v-86530b6c><span class="text" data-v-86530b6c><!----><span class="vpi-languages option-icon" data-v-86530b6c></span><!----><!----><span class="vpi-chevron-down text-icon" data-v-86530b6c></span></span></button><div class="menu" data-v-86530b6c><div class="vp-menu" data-v-86530b6c data-v-709dc2b1><!----><!--[--><!--[--><div class="items" data-v-0d45479b><p class="title" data-v-0d45479b>简体中文</p><!--[--><div class="vp-menu-link" data-v-0d45479b data-v-1ff1855f><a class="vp-link link" href="/en/" data-v-1ff1855f><!--[--><!----> English <!----><!--]--><!----></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="vp-navbar-appearance appearance" data-v-2c31ea5e data-v-a295abf6><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-a295abf6 data-v-596c25a9 data-v-7eb32327><span class="check" data-v-7eb32327><span class="icon" data-v-7eb32327><!--[--><span class="vpi-sun sun" data-v-596c25a9></span><span class="vpi-moon moon" data-v-596c25a9></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-2c31ea5e data-v-ad52545c data-v-40bac536><!--[--><a class="vp-social-link no-icon" href="https://github.com/PersistentJZH" aria-label="github" target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-2c31ea5e data-v-652282fd data-v-86530b6c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-86530b6c><span class="vpi-more-horizontal icon" data-v-86530b6c></span></button><div class="menu" data-v-86530b6c><div class="vp-menu" data-v-86530b6c data-v-709dc2b1><!----><!--[--><!--[--><!----><div class="group" data-v-652282fd><div class="item appearance" data-v-652282fd><p class="label" data-v-652282fd>外观</p><div class="appearance-action" data-v-652282fd><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-652282fd data-v-596c25a9 data-v-7eb32327><span class="check" data-v-7eb32327><span class="icon" data-v-7eb32327><!--[--><span class="vpi-sun sun" data-v-596c25a9></span><span class="vpi-moon moon" data-v-596c25a9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-652282fd><div class="item social-links" data-v-652282fd><div class="vp-social-links social-links-list" data-v-652282fd data-v-40bac536><!--[--><a class="vp-social-link no-icon" href="https://github.com/PersistentJZH" aria-label="github" target="_blank" rel="noopener" data-v-40bac536 data-v-67b21932><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-2c31ea5e data-v-2b50024d><span class="container" data-v-2b50024d><span class="top" data-v-2b50024d></span><span class="middle" data-v-2b50024d></span><span class="bottom" data-v-2b50024d></span></span></button></div></div></div></div><div class="divider" data-v-2c31ea5e><div class="divider-line" data-v-2c31ea5e></div></div></div><!----></header><div class="vp-local-nav reached-top" data-v-d90a7a26 data-v-3944d8e8><button class="menu" aria-expanded="false" aria-controls="SidebarNav" data-v-3944d8e8><span class="vpi-align-left menu-icon" data-v-3944d8e8></span><span class="menu-text" data-v-3944d8e8>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-3944d8e8 data-v-4114a62c><button data-v-4114a62c>返回顶部</button><!----></div></div><aside class="vp-sidebar" vp-sidebar data-v-d90a7a26 data-v-95211354><div class="curtain" data-v-95211354></div><nav id="SidebarNav" class="nav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-95211354><span id="sidebar-aria-label" class="visually-hidden" data-v-95211354> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-473fd05b><section class="vp-sidebar-item sidebar-item level-0 collapsible has-active" data-v-473fd05b data-v-12048f0f><div class="item" role="button" tabindex="0" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><h2 class="text" data-v-12048f0f><span data-v-12048f0f> 基础</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12048f0f><span class="vpi-chevron-right caret-icon" data-v-12048f0f></span></div></div><div data-v-12048f0f data-v-12048f0f><div class="items" data-v-12048f0f><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/rwl9lg2c/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>kind 常用命令详解</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/hreo17tb/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>service原理</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/se02n0mk/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>Kubernetes Webhook 详解与实践</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/3ul73e1l/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>Helm 使用指南</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/m5e88tbo/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>Kubernetes Job和CronJob详解</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/atnvxy1k/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>pvc</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/ildksm1z/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>Kubernetes CLI-Runtime 详解</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/4iyz7vyg/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>⛳️docker</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/1ygxqk6d/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>🏄‍♂️ HPA</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/zqfais6m/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>⛵️kubelet</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/l9h2s052/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>🫣operator</span><!----></p><!--]--><!----></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-473fd05b><section class="vp-sidebar-item sidebar-item level-0 collapsible" data-v-473fd05b data-v-12048f0f><div class="item" role="button" tabindex="0" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><h2 class="text" data-v-12048f0f><span data-v-12048f0f> 网络</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12048f0f><span class="vpi-chevron-right caret-icon" data-v-12048f0f></span></div></div><div data-v-12048f0f data-v-12048f0f><div class="items" data-v-12048f0f><!--[--><section class="vp-sidebar-item sidebar-item level-1 collapsible" data-v-12048f0f data-v-12048f0f><div class="item" role="button" tabindex="0" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><h3 class="text" data-v-12048f0f><span data-v-12048f0f>网络插件基础</span><!----></h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12048f0f><span class="vpi-chevron-right caret-icon" data-v-12048f0f></span></div></div><div data-v-12048f0f data-v-12048f0f><div class="items" data-v-12048f0f><!--[--><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/tvrhac3r/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>kubelet与cni</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/34fs59t4/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>🥅cni</span><!----></p><!--]--><!----></a><!----></div><!----></div><!--]--></div></div></section><section class="vp-sidebar-item sidebar-item level-1 collapsible" data-v-12048f0f data-v-12048f0f><div class="item" role="button" tabindex="0" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><h3 class="text" data-v-12048f0f><span data-v-12048f0f>Calico</span><!----></h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12048f0f><span class="vpi-chevron-right caret-icon" data-v-12048f0f></span></div></div><div data-v-12048f0f data-v-12048f0f><div class="items" data-v-12048f0f><!--[--><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/eigpt0xy/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>🐦‍🔥Bird的使用</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/ayl6l9u6/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>🐱Calico架构和使用</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/1q63pwfs/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>📦Calico原理分析</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/5ueb9pny/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>ip pool的使用</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/yg88mc7r/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>🧀Service路由宣告</span><!----></p><!--]--><!----></a><!----></div><!----></div><!--]--></div></div></section><section class="vp-sidebar-item sidebar-item level-1 collapsible" data-v-12048f0f data-v-12048f0f><div class="item" role="button" tabindex="0" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><h3 class="text" data-v-12048f0f><span data-v-12048f0f>flannel</span><!----></h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12048f0f><span class="vpi-chevron-right caret-icon" data-v-12048f0f></span></div></div><div data-v-12048f0f data-v-12048f0f><div class="items" data-v-12048f0f><!--[--><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/l1e57s3y/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>🏃flannel</span><!----></p><!--]--><!----></a><!----></div><!----></div><!--]--></div></div></section><!--]--></div></div></section></div><div class="no-transition group" data-v-473fd05b><section class="vp-sidebar-item sidebar-item level-0 collapsible" data-v-473fd05b data-v-12048f0f><div class="item" role="button" tabindex="0" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><h2 class="text" data-v-12048f0f><span data-v-12048f0f> 源码分析</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12048f0f><span class="vpi-chevron-right caret-icon" data-v-12048f0f></span></div></div><div data-v-12048f0f data-v-12048f0f><div class="items" data-v-12048f0f><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/l75zjmj1/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>⛵️apiserver源码</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/x4d7orno/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>💪controller-manager源码</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/slfkzgfd/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>🛶kubelet源码</span><!----></p><!--]--><!----></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-473fd05b><section class="vp-sidebar-item sidebar-item level-0 collapsible" data-v-473fd05b data-v-12048f0f><div class="item" role="button" tabindex="0" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><h2 class="text" data-v-12048f0f><span data-v-12048f0f> k8s增强</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12048f0f><span class="vpi-chevron-right caret-icon" data-v-12048f0f></span></div></div><div data-v-12048f0f data-v-12048f0f><div class="items" data-v-12048f0f><!--[--><section class="vp-sidebar-item sidebar-item level-1 collapsible" data-v-12048f0f data-v-12048f0f><div class="item" role="button" tabindex="0" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><h3 class="text" data-v-12048f0f><span data-v-12048f0f>kruise-rollout</span><!----></h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12048f0f><span class="vpi-chevron-right caret-icon" data-v-12048f0f></span></div></div><div data-v-12048f0f data-v-12048f0f><div class="items" data-v-12048f0f><!--[--><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/egsg3eyn/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>发布类型</span><!----></p><!--]--><!----></a><!----></div><!----></div><!--]--></div></div></section><section class="vp-sidebar-item sidebar-item level-1 collapsible" data-v-12048f0f data-v-12048f0f><div class="item" role="button" tabindex="0" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><h3 class="text" data-v-12048f0f><span data-v-12048f0f>openkruise</span><!----></h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12048f0f><span class="vpi-chevron-right caret-icon" data-v-12048f0f></span></div></div><div data-v-12048f0f data-v-12048f0f><div class="items" data-v-12048f0f><!--[--><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/7gptvl9g/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>cloneSet</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/er3d3vot/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>原地升级</span><!----></p><!--]--><!----></a><!----></div><!----></div><!--]--></div></div></section><!--]--></div></div></section></div><div class="no-transition group" data-v-473fd05b><section class="vp-sidebar-item sidebar-item level-0 collapsible" data-v-473fd05b data-v-12048f0f><div class="item" role="button" tabindex="0" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><h2 class="text" data-v-12048f0f><span data-v-12048f0f>github_pr</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12048f0f><span class="vpi-chevron-right caret-icon" data-v-12048f0f></span></div></div><div data-v-12048f0f data-v-12048f0f><div class="items" data-v-12048f0f><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/kz69s4r4/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>calico_1</span><!----></p><!--]--><!----></a><!----></div><!----></div><!--]--></div></div></section></div><div class="no-transition group" data-v-473fd05b><section class="vp-sidebar-item sidebar-item level-0 collapsible" data-v-473fd05b data-v-12048f0f><div class="item" role="button" tabindex="0" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><h2 class="text" data-v-12048f0f><span data-v-12048f0f>spire</span><!----></h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-12048f0f><span class="vpi-chevron-right caret-icon" data-v-12048f0f></span></div></div><div data-v-12048f0f data-v-12048f0f><div class="items" data-v-12048f0f><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/7dl60axt/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>reconcile</span><!----></p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-12048f0f data-v-12048f0f><div class="item" data-v-12048f0f><div class="indicator" data-v-12048f0f></div><!----><a class="vp-link link link" href="/k8s/k90axrjc/" data-v-12048f0f><!--[--><p class="text" data-v-12048f0f><span data-v-12048f0f>spire基础</span><!----></p><!--]--><!----></a><!----></div><!----></div><!--]--></div></div></section></div><!--]--><!--[--><!--]--></nav></aside><!--[--><div id="VPContent" vp-content class="vp-content has-sidebar" data-v-d90a7a26 data-v-b2beaca7><div class="vp-doc-container has-sidebar has-aside" data-v-b2beaca7 data-v-23f6ad98><!--[--><!--]--><div class="container" data-v-23f6ad98><div class="aside" vp-outline data-v-23f6ad98><div class="aside-curtain" data-v-23f6ad98></div><div class="aside-container" data-v-23f6ad98><div class="aside-content" data-v-23f6ad98><div class="vp-doc-aside" data-v-23f6ad98 data-v-5976474c><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="vp-doc-aside-outline" role="navigation" data-v-5976474c data-v-aa56eba0><div class="content" data-v-aa56eba0><div class="outline-marker" data-v-aa56eba0></div><div id="doc-outline-aria-label" aria-level="2" class="outline-title" role="heading" data-v-aa56eba0><span data-v-aa56eba0>此页内容</span><span class="vpi-print icon" data-v-aa56eba0></span></div><ul class="root" data-v-aa56eba0 data-v-3e6b023c><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-5976474c></div><!--[--><!--]--></div></div></div></div><div class="content" data-v-23f6ad98><div class="content-container" data-v-23f6ad98><!--[--><!--]--><main class="main" data-v-23f6ad98><nav class="vp-breadcrumb" data-v-23f6ad98 data-v-1ae4ad7a><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-1ae4ad7a><!--[--><li property="itemListElement" typeof="ListItem" data-v-1ae4ad7a><a class="vp-link link breadcrumb" href="/" property="item" typeof="WebPage" data-v-1ae4ad7a><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-1ae4ad7a></span><meta property="name" content="首页" data-v-1ae4ad7a><meta property="position" content="1" data-v-1ae4ad7a></li><li property="itemListElement" typeof="ListItem" data-v-1ae4ad7a><span class="vp-link breadcrumb" property="item" typeof="WebPage" data-v-1ae4ad7a><!--[--> 基础<!--]--><!----></span><span class="vpi-chevron-right" data-v-1ae4ad7a></span><meta property="name" content=" 基础" data-v-1ae4ad7a><meta property="position" content="2" data-v-1ae4ad7a></li><li property="itemListElement" typeof="ListItem" data-v-1ae4ad7a><a class="vp-link link breadcrumb current" href="/k8s/hreo17tb/" property="item" typeof="WebPage" data-v-1ae4ad7a><!--[-->service原理<!--]--><!----></a><!----><meta property="name" content="service原理" data-v-1ae4ad7a><meta property="position" content="3" data-v-1ae4ad7a></li><!--]--></ol></nav><!--[--><!--]--><!--[--><h1 class="vp-doc-title page-title" data-v-27be53cb>service原理 <!----></h1><div class="vp-doc-meta" data-v-27be53cb><!--[--><!--]--><p class="reading-time" data-v-27be53cb><span class="vpi-books icon" data-v-27be53cb></span><span data-v-27be53cb>约 3024 字</span><span data-v-27be53cb>大约 10 分钟</span></p><!----><!--[--><!--]--><p class="create-time" data-v-27be53cb><span class="vpi-clock icon" data-v-27be53cb></span><span data-v-27be53cb>2025-08-03</span></p></div><!--]--><!--[--><!--]--><div class="_k8s_hreo17tb_ external-link-icon-enabled vp-doc plume-content" vp-content data-v-23f6ad98><!--[--><!--]--><div data-v-23f6ad98><h2 id="一、kubernetes-service-概述" tabindex="-1"><a class="header-anchor" href="#一、kubernetes-service-概述"><span>一、Kubernetes Service 概述</span></a></h2><p>Kubernetes Service 是 Kubernetes 系统中的核心抽象概念之一，它为运行在集群中的应用程序提供稳定的网络端点。Service 解决了 Pod 动态特性带来的网络连接问题：</p><ol><li><p><strong>Pod 动态性挑战</strong>：</p><ul><li>Pod 是临时的，可能随时被创建或销毁</li><li>Pod IP 会随着重启或迁移而变化</li><li>部署规模可能动态伸缩</li></ul></li><li><p><strong>Service 提供的解决方案</strong>：</p><ul><li>稳定的虚拟 IP (VIP) 和 DNS 名称</li><li>自动负载均衡到后端 Pod</li><li>服务发现机制</li><li>多种暴露服务的方式</li></ul></li></ol><h2 id="二、service-的-vip-机制详解" tabindex="-1"><a class="header-anchor" href="#二、service-的-vip-机制详解"><span>二、Service 的 VIP 机制详解</span></a></h2><h3 id="_2-1-vip-的分配与管理" tabindex="-1"><a class="header-anchor" href="#_2-1-vip-的分配与管理"><span>2.1 VIP 的分配与管理</span></a></h3><p>Service 的 ClusterIP 是一个虚拟 IP (VIP)，其生命周期管理包括：</p><ol><li><p><strong>IP 分配机制</strong>：</p><ul><li>由 kube-apiserver 从配置的 <code>service-cluster-ip-range</code> 中分配</li><li>分配范围通过 <code>--service-cluster-ip-range</code> 参数指定（如 10.96.0.0/12）</li><li>分配是顺序进行的，由 etcd 保证原子性</li></ul></li><li><p><strong>VIP 特性</strong>：</p><ul><li>不绑定在任何物理/虚拟网络接口上</li><li>不响应 ARP 请求</li><li>仅存在于 Kubernetes 网络规则中</li><li>生命周期内保持不变（即使所有后端 Pod 更换）</li></ul></li><li><p><strong>IP 回收</strong>：</p><ul><li>Service 删除后其 ClusterIP 被回收</li><li>可配置是否允许 IP 重用</li></ul></li></ol><h3 id="_2-2-vip-的路由原理" tabindex="-1"><a class="header-anchor" href="#_2-2-vip-的路由原理"><span>2.2 VIP 的路由原理</span></a></h3><p>VIP 能够在集群内路由依赖于以下协同工作机制：</p><ol><li><p><strong>kube-proxy 的规则维护</strong>：</p><ul><li>在每个节点上设置网络规则（iptables/IPVS）</li><li>将 VIP 映射到实际 Pod IP</li></ul></li><li><p><strong>CNI 网络插件</strong>：</p><ul><li>确保所有 Pod 位于同一扁平网络或可路由</li><li>维护节点间的网络连通性</li></ul></li><li><p><strong>内核网络栈处理</strong>：</p><ul><li>通过 netfilter 框架实现地址转换</li><li>路由子系统负责最终转发</li></ul></li></ol><h2 id="三、kube-proxy-深度解析" tabindex="-1"><a class="header-anchor" href="#三、kube-proxy-深度解析"><span>三、kube-proxy 深度解析</span></a></h2><h3 id="_3-1-kube-proxy-的三种模式" tabindex="-1"><a class="header-anchor" href="#_3-1-kube-proxy-的三种模式"><span>3.1 kube-proxy 的三种模式</span></a></h3><h4 id="_3-1-1-userspace-模式-已弃用" tabindex="-1"><a class="header-anchor" href="#_3-1-1-userspace-模式-已弃用"><span>3.1.1 userspace 模式（已弃用）</span></a></h4><p><strong>工作原理</strong>：</p><ol><li>kube-proxy 在用户空间监听 Service 和 Endpoint 变化</li><li>为每个 Service 打开一个随机端口</li><li>通过 iptables 规则将流量重定向到这个端口</li><li>kube-proxy 进程内部实现负载均衡</li></ol><p><strong>缺点</strong>：</p><ul><li>用户态和内核态切换开销大</li><li>性能较差</li></ul><h4 id="_3-1-2-iptables-模式-默认" tabindex="-1"><a class="header-anchor" href="#_3-1-2-iptables-模式-默认"><span>3.1.2 iptables 模式（默认）</span></a></h4><p><strong>架构设计</strong>：</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>+---------------------------------------------------+</span></span>
<span class="line"><span>|                   Pod A                           |</span></span>
<span class="line"><span>| 发起请求: curl 10.96.1.1:80            |</span></span>
<span class="line"><span>+---------------------------------------------------+</span></span>
<span class="line"><span>            |</span></span>
<span class="line"><span>            v</span></span>
<span class="line"><span>+---------------------------------------------------+</span></span>
<span class="line"><span>|               主机网络栈                          |</span></span>
<span class="line"><span>|   PREROUTING -&gt; KUBE-SERVICES -&gt; KUBE-SVC-XXX     |</span></span>
<span class="line"><span>|   -&gt; KUBE-SEP-XXX (DNAT) -&gt; 路由决策             |</span></span>
<span class="line"><span>+---------------------------------------------------+</span></span>
<span class="line"><span>            |</span></span>
<span class="line"><span>            v</span></span>
<span class="line"><span>+---------------------------------------------------+</span></span>
<span class="line"><span>|                   Pod B                           |</span></span>
<span class="line"><span>| 接收请求: 10.244.1.2:80               |</span></span>
<span class="line"><span>+---------------------------------------------------+</span></span></code></pre></div><p><strong>规则示例</strong>：</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Service 入口规则</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-A</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> KUBE-SERVICES</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 10.96.1.1/32</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> tcp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -m</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> tcp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --dport</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 80</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -j</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> KUBE-SVC-ABC123</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 负载均衡规则（50%概率选择第一个后端）</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-A</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> KUBE-SVC-ABC123</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -m</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> statistic</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --mode</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> random</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --probability</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0.5</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -j</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> KUBE-SEP-DEF456</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-A</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> KUBE-SVC-ABC123</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -j</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> KUBE-SEP-GHI789</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 端点 DNAT 规则</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-A</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> KUBE-SEP-DEF456</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> tcp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -m</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> tcp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -j</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> DNAT</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --to-destination</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 10.244.1.2:80</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">-A</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> KUBE-SEP-GHI789</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> tcp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -m</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> tcp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -j</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> DNAT</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --to-destination</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 10.244.2.3:80</span></span></code></pre></div><p><strong>特点</strong>：</p><ul><li>完全在内核空间处理，性能好</li><li>规则数量随 Service 和 Pod 数量线性增长</li><li>负载均衡算法简单（随机平等选择）</li></ul><h4 id="_3-1-3-ipvs-模式-生产推荐" tabindex="-1"><a class="header-anchor" href="#_3-1-3-ipvs-模式-生产推荐"><span>3.1.3 IPVS 模式（生产推荐）</span></a></h4><p><strong>架构优势</strong>：</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>+---------------------------------------------------+</span></span>
<span class="line"><span>|                IPVS 内核模块                      |</span></span>
<span class="line"><span>|   +---------------------+                        |</span></span>
<span class="line"><span>|   |  Virtual Service    | 10.96.1.1:80           |</span></span>
<span class="line"><span>|   +---------------------+                        |</span></span>
<span class="line"><span>|     |                  |                         |</span></span>
<span class="line"><span>|     v                  v                         |</span></span>
<span class="line"><span>| +-----------+     +-----------+                  |</span></span>
<span class="line"><span>| | Real Server |    | Real Server |               |</span></span>
<span class="line"><span>| | 10.244.1.2 |    | 10.244.2.3 |                |</span></span>
<span class="line"><span>| +-----------+     +-----------+                  |</span></span>
<span class="line"><span>+---------------------------------------------------+</span></span></code></pre></div><p><strong>配置示例</strong>：</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 创建虚拟服务（使用轮询算法）</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ipvsadm</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -A</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -t</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 10.96.1.1:80</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> rr</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 添加真实服务器</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ipvsadm</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -a</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -t</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 10.96.1.1:80</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -r</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 10.244.1.2:80</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -m</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # NAT 模式</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ipvsadm</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -a</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -t</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 10.96.1.1:80</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -r</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 10.244.2.3:80</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -m</span></span></code></pre></div><p><strong>优势</strong>：</p><ul><li>支持多种负载均衡算法（rr, wrr, lc, wlc 等）</li><li>时间复杂度 O(1)，适合大规模集群</li><li>更精细的流量控制能力</li></ul><h3 id="_3-2-kube-proxy-的数据流详细分析" tabindex="-1"><a class="header-anchor" href="#_3-2-kube-proxy-的数据流详细分析"><span>3.2 kube-proxy 的数据流详细分析</span></a></h3><h4 id="_3-2-1-同节点-pod-间通信" tabindex="-1"><a class="header-anchor" href="#_3-2-1-同节点-pod-间通信"><span>3.2.1 同节点 Pod 间通信</span></a></h4><p><strong>数据流路径</strong>：</p><ol><li><p><strong>Pod 出站</strong>：</p><ul><li>应用发起请求：<code>curl 10.96.1.1:80</code></li><li>数据包：src=10.244.0.1, dst=10.96.1.1, dport=80</li></ul></li><li><p><strong>veth 设备传输</strong>：</p><ul><li>通过 veth pair 离开 Pod 网络命名空间</li><li>到达主机侧的虚拟网卡（如 veth123）</li></ul></li><li><p><strong>主机网络栈处理</strong>：</p><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div style="display:flex;align-items:center;justify-content:center;height:96px;" class="mermaid-loading"><span style="--loading-icon: url(&quot;data:image/svg+xml;utf8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; preserveAspectRatio=&#39;xMidYMid&#39; viewBox=&#39;25 25 50 50&#39;%3E%3CanimateTransform attributeName=&#39;transform&#39; type=&#39;rotate&#39; dur=&#39;2s&#39; keyTimes=&#39;0;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;360&#39;%3E%3C/animateTransform%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;20&#39; fill=&#39;none&#39; stroke=&#39;currentColor&#39; stroke-width=&#39;4&#39; stroke-linecap=&#39;round&#39;%3E%3Canimate attributeName=&#39;stroke-dasharray&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;1,200;90,200;1,200&#39;%3E%3C/animate%3E%3Canimate attributeName=&#39;stroke-dashoffset&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;-35px;-125px&#39;%3E%3C/animate%3E%3C/circle%3E%3C/svg%3E&quot;);--icon-size: 48px;display: inline-block;width: var(--icon-size);height: var(--icon-size);background-color: currentcolor;-webkit-mask-image: var(--loading-icon);mask-image: var(--loading-icon)"></span></div></div><!--]--></li><li><p><strong>路由决策</strong>：</p><ul><li>内核检查目标 IP 10.244.1.2</li><li>通过路由表确认是本地 Pod</li><li>示例路由：<code>10.244.1.0/24 dev cni0 scope link</code></li></ul></li><li><p><strong>桥接转发</strong>：</p><ul><li>通过 cni0 网桥转发</li><li>到达目标 Pod 的 veth 接口</li></ul></li></ol><h4 id="_3-2-2-跨节点-pod-通信" tabindex="-1"><a class="header-anchor" href="#_3-2-2-跨节点-pod-通信"><span>3.2.2 跨节点 Pod 通信</span></a></h4><p><strong>关键差异点</strong>：</p><ol><li><p><strong>路由阶段</strong>：</p><ul><li>内核发现目标 IP 非本地（如 10.244.2.3）</li><li>查询路由表找到节点路由：<code>10.244.2.0/24 via 192.168.1.2 dev eth0</code></li></ul></li><li><p><strong>跨节点传输</strong>：</p><ul><li>封装方式取决于 CNI 插件（如 VXLAN、IPIP 或直接路由）</li><li>目标节点收到后解封装并转发到目标 Pod</li></ul></li><li><p><strong>返回路径</strong>：</p><ul><li>目标 Pod 响应时直接返回源 Pod IP</li><li>不需要经过 Service VIP 的逆向转换</li></ul></li></ol><h3 id="_3-3-关键网络栈处理顺序" tabindex="-1"><a class="header-anchor" href="#_3-3-关键网络栈处理顺序"><span>3.3 关键网络栈处理顺序</span></a></h3><p><strong>Linux 网络数据包处理流程</strong>：</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>+-----------------------+</span></span>
<span class="line"><span>|    Pod 出站数据包      |</span></span>
<span class="line"><span>+-----------------------+</span></span>
<span class="line"><span>           |</span></span>
<span class="line"><span>           v</span></span>
<span class="line"><span>+-----------------------+</span></span>
<span class="line"><span>| 主机网络栈 PREROUTING  | &lt;-- iptables 规则最先处理</span></span>
<span class="line"><span>+-----------------------+</span></span>
<span class="line"><span>           |</span></span>
<span class="line"><span>           v</span></span>
<span class="line"><span>+-----------------------+</span></span>
<span class="line"><span>|     路由决策           | &lt;-- 基于 DNAT 后的目标地址</span></span>
<span class="line"><span>+-----------------------+</span></span>
<span class="line"><span>           |</span></span>
<span class="line"><span>           v</span></span>
<span class="line"><span>+-----------------------+</span></span>
<span class="line"><span>|    POSTROUTING        | &lt;-- 可能的 SNAT 处理</span></span>
<span class="line"><span>+-----------------------+</span></span>
<span class="line"><span>           |</span></span>
<span class="line"><span>           v</span></span>
<span class="line"><span>+-----------------------+</span></span>
<span class="line"><span>|   出站网络接口         |</span></span>
<span class="line"><span>+-----------------------+</span></span></code></pre></div><p><strong>重要结论</strong>：</p><ol><li><strong>DNAT 先于路由决策</strong>：系统先通过 iptables 修改目标地址，然后才做路由</li><li><strong>Service 访问本质</strong>：VIP 仅在控制平面有意义，数据平面始终使用真实 Pod IP</li><li><strong>性能影响点</strong>：大规模集群中 iptables 规则数量会影响网络性能</li></ol><h2 id="四、生产实践建议" tabindex="-1"><a class="header-anchor" href="#四、生产实践建议"><span>四、生产实践建议</span></a></h2><h3 id="_4-1-模式选择" tabindex="-1"><a class="header-anchor" href="#_4-1-模式选择"><span>4.1 模式选择</span></a></h3><ol><li><p><strong>中小集群</strong>：</p><ul><li>默认 iptables 模式即可</li><li>规则数量 &lt; 5000 时性能可接受</li></ul></li><li><p><strong>大型集群</strong>：</p><ul><li>推荐 IPVS 模式</li><li>特别适合 Service 数量多或频繁变动的场景</li></ul></li></ol><h3 id="_4-2-性能调优" tabindex="-1"><a class="header-anchor" href="#_4-2-性能调优"><span>4.2 性能调优</span></a></h3><ol><li><p><strong>IPVS 参数优化</strong>：</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 调整连接哈希表大小</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2097152</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /sys/module/nf_conntrack/parameters/hashsize</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 增加 IPVS 连接表大小</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ipvsadm</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --set</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 262144</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 262144</span></span></code></pre></div></li><li><p><strong>iptables 模式优化</strong>：</p><ul><li>定期清理僵尸规则</li><li>考虑使用 <code>--random-fully</code> 选项避免端口冲突</li></ul></li></ol><h3 id="_4-3-监控与排错" tabindex="-1"><a class="header-anchor" href="#_4-3-监控与排错"><span>4.3 监控与排错</span></a></h3><p><strong>关键监控指标</strong>：</p><ol><li><code>kube_proxy_sync_proxy_rules_duration_seconds</code>：规则同步耗时</li><li><code>kube_proxy_network_programming_duration_seconds</code>：网络编程延迟</li><li><code>ipvs_connections</code>：IPVS 当前连接数</li></ol><p><strong>常见问题排查</strong>：</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 检查 iptables 规则</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">iptables-save</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> KUBE-SVC</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 检查 IPVS 配置</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ipvsadm</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -Ln</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 检查路由表</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> route</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> show</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> table</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> all</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 检查连接跟踪</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">conntrack</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -L</span></span></code></pre></div><h2 id="五、总结" tabindex="-1"><a class="header-anchor" href="#五、总结"><span>五、总结</span></a></h2><p>Kubernetes Service 和 kube-proxy 共同构成了集群内服务通信的基础设施：</p><ol><li><p><strong>Service</strong> 提供稳定的抽象层：</p><ul><li>通过 VIP 屏蔽后端 Pod 变化</li><li>多种类型满足不同暴露需求</li><li>内置负载均衡能力</li></ul></li><li><p><strong>kube-proxy</strong> 实现数据平面：</p><ul><li>多种模式适应不同规模场景</li><li>利用内核能力实现高效转发</li><li>实时响应集群状态变化</li></ul></li><li><p><strong>整体协作</strong>：</p><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div style="display:flex;align-items:center;justify-content:center;height:96px;" class="mermaid-loading"><span style="--loading-icon: url(&quot;data:image/svg+xml;utf8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; preserveAspectRatio=&#39;xMidYMid&#39; viewBox=&#39;25 25 50 50&#39;%3E%3CanimateTransform attributeName=&#39;transform&#39; type=&#39;rotate&#39; dur=&#39;2s&#39; keyTimes=&#39;0;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;360&#39;%3E%3C/animateTransform%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;20&#39; fill=&#39;none&#39; stroke=&#39;currentColor&#39; stroke-width=&#39;4&#39; stroke-linecap=&#39;round&#39;%3E%3Canimate attributeName=&#39;stroke-dasharray&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;1,200;90,200;1,200&#39;%3E%3C/animate%3E%3Canimate attributeName=&#39;stroke-dashoffset&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;-35px;-125px&#39;%3E%3C/animate%3E%3C/circle%3E%3C/svg%3E&quot;);--icon-size: 48px;display: inline-block;width: var(--icon-size);height: var(--icon-size);background-color: currentcolor;-webkit-mask-image: var(--loading-icon);mask-image: var(--loading-icon)"></span></div></div><!--]--></li></ol><p>理解这些底层机制有助于：</p><ul><li>更合理地设计微服务架构</li><li>高效排查网络问题</li><li>针对特定场景进行性能优化</li><li>安全策略的精确实施</li></ul><p>随着 Kubernetes 生态发展，Service 的实现也在不断演进（如 Cilium 的 eBPF 实现），但核心思想保持不变：提供稳定、可靠的网络抽象层。</p><h1 id="kubernetes-外部访问方案详解-externalips-与-nodeport-全面解析" tabindex="-1"><a class="header-anchor" href="#kubernetes-外部访问方案详解-externalips-与-nodeport-全面解析"><span>Kubernetes 外部访问方案详解：externalIPs 与 NodePort 全面解析</span></a></h1><h2 id="一、概述" tabindex="-1"><a class="header-anchor" href="#一、概述"><span>一、概述</span></a></h2><p>在 Kubernetes 集群中，Service 作为 Pod 的抽象和负载均衡机制，提供了多种暴露服务到外部网络的方式。本文将深入探讨两种重要的外部访问方案：externalIPs 和 NodePort，分析它们的工作原理、配置方法、适用场景以及最佳实践。</p><h2 id="二、externalips-深度解析" tabindex="-1"><a class="header-anchor" href="#二、externalips-深度解析"><span>二、externalIPs 深度解析</span></a></h2><h3 id="_2-1-基本概念" tabindex="-1"><a class="header-anchor" href="#_2-1-基本概念"><span>2.1 基本概念</span></a></h3><p>externalIPs 是 Service 的一个配置字段，允许管理员指定一个或多个外部 IP 地址来暴露服务。与自动分配的 LoadBalancer IP 不同，externalIPs 需要手动配置和管理。</p><h3 id="_2-2-核心工作原理" tabindex="-1"><a class="header-anchor" href="#_2-2-核心工作原理"><span>2.2 核心工作原理</span></a></h3><ol><li><p><strong>网络流量路径</strong>：</p><ul><li>外部客户端 → 指定的 externalIP → 节点网络栈 → kube-proxy → Service → Pod</li></ul></li><li><p><strong>IP 分配要求</strong>：</p><ul><li>该 IP 必须直接绑定到节点网络接口</li><li>或者通过网络路由可达（需配置正确路由）</li></ul></li><li><p><strong>多节点处理</strong>：</p><ul><li>当 externalIP 配置在多个节点时，kube-proxy 会确保流量被正确转发</li></ul></li></ol><h3 id="_2-3-详细配置指南" tabindex="-1"><a class="header-anchor" href="#_2-3-详细配置指南"><span>2.3 详细配置指南</span></a></h3><h4 id="基础-yaml-示例" tabindex="-1"><a class="header-anchor" href="#基础-yaml-示例"><span>基础 YAML 示例：</span></a></h4><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">apiVersion</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> v1</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">kind</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Service</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">metadata</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> externalip-service</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">spec</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  selector</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    app</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MyApp</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  ports</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> protocol</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> TCP</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">      port</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 80</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">      targetPort</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 9376</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  externalIPs</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 203.0.113.10</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 198.51.100.5</span></span></code></pre></div><h4 id="高级配置选项" tabindex="-1"><a class="header-anchor" href="#高级配置选项"><span>高级配置选项：</span></a></h4><ul><li>多端口支持</li><li>不同协议的混合配置</li><li>与 sessionAffinity 配合使用</li></ul><h3 id="_2-4-网络基础设施要求" tabindex="-1"><a class="header-anchor" href="#_2-4-网络基础设施要求"><span>2.4 网络基础设施要求</span></a></h3><ol><li><p><strong>IP 分配方案</strong>：</p><ul><li>静态配置于节点接口</li></ul><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> addr</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> add</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 203.0.113.10/24</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dev</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> eth0</span></span></code></pre></div><ul><li>通过 DHCP 保留</li><li>云平台的浮动 IP</li></ul></li><li><p><strong>路由配置</strong>：</p><ul><li>静态路由配置示例（Cisco）：</li></ul><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>ip route 203.0.113.10 255.255.255.255 &lt;node-ip&gt;</span></span></code></pre></div></li><li><p><strong>防火墙规则</strong>：</p><ul><li>需要开放指定端口</li><li>考虑源 IP 限制</li></ul></li></ol><h3 id="_2-5-验证与排错" tabindex="-1"><a class="header-anchor" href="#_2-5-验证与排错"><span>2.5 验证与排错</span></a></h3><ol><li>验证步骤：</li></ol><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 检查 Service 配置</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> describe</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> svc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> externalip-service</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 测试连通性</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">curl</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -v</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> http://203.0.113.10:80</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 检查节点网络配置</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> get</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nodes</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -o</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> wide</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ssh</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> node01</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> addr</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> show</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 203.0.113.10</span></span></code></pre></div><ol start="2"><li>常见问题排查：</li></ol><ul><li>IP 未正确分配到节点</li><li>路由配置错误</li><li>防火墙阻止访问</li><li>kube-proxy 服务异常</li></ul><h2 id="三、nodeport-全面剖析" tabindex="-1"><a class="header-anchor" href="#三、nodeport-全面剖析"><span>三、NodePort 全面剖析</span></a></h2><h3 id="_3-1-基本架构" tabindex="-1"><a class="header-anchor" href="#_3-1-基本架构"><span>3.1 基本架构</span></a></h3><p>NodePort 服务在每个节点上开放一个静态端口（默认 30000-32767），通过该端口将外部流量转发到 Service。</p><h4 id="流量路径" tabindex="-1"><a class="header-anchor" href="#流量路径"><span>流量路径：</span></a></h4><p>外部客户端 → 任意节点IP:NodePort → Service → Pod</p><h3 id="_3-2-详细配置方法" tabindex="-1"><a class="header-anchor" href="#_3-2-详细配置方法"><span>3.2 详细配置方法</span></a></h3><h4 id="基础-yaml" tabindex="-1"><a class="header-anchor" href="#基础-yaml"><span>基础 YAML：</span></a></h4><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">apiVersion</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> v1</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">kind</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Service</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">metadata</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nodeport-demo</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">spec</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> NodePort</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  selector</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    app</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MyApp</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  ports</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> http</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">      port</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 80</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">      targetPort</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 8080</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">      nodePort</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 31000</span></span></code></pre></div><h4 id="高级配置选项-1" tabindex="-1"><a class="header-anchor" href="#高级配置选项-1"><span>高级配置选项：</span></a></h4><ul><li>自定义端口范围</li><li>多协议支持</li><li>特定节点选择</li></ul><h3 id="_3-3-端口管理" tabindex="-1"><a class="header-anchor" href="#_3-3-端口管理"><span>3.3 端口管理</span></a></h3><ol><li>默认端口范围：30000-32767</li><li>修改范围（需修改 API Server 配置）：</li></ol><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># /etc/kubernetes/manifests/kube-apiserver.yaml</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">spec</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  containers</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> command</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> kube-apiserver</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> --service-node-port-range=30000-35000</span></span></code></pre></div><h3 id="_3-4-负载均衡策略" tabindex="-1"><a class="header-anchor" href="#_3-4-负载均衡策略"><span>3.4 负载均衡策略</span></a></h3><ol><li><p><strong>内置负载均衡</strong>：</p><ul><li>基于 kube-proxy 的轮询算法</li><li>支持 sessionAffinity</li></ul></li><li><p><strong>外部负载均衡集成</strong>：</p><ul><li>云负载均衡器配置示例（AWS ALB）：</li></ul><div class="language-terraform" data-highlighter="shiki" data-ext="terraform" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-terraform"><span class="line"><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">resource</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> &quot;aws_lb_target_group&quot;</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> &quot;example&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  port     </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 31000</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  protocol </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">HTTP</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">  vpc_id   </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> aws_vpc</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">main</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">id</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div></li></ol><h3 id="_3-5-安全最佳实践" tabindex="-1"><a class="header-anchor" href="#_3-5-安全最佳实践"><span>3.5 安全最佳实践</span></a></h3><ol><li>网络策略（NetworkPolicy）：</li></ol><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">apiVersion</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">kind</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> NetworkPolicy</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">metadata</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nodeport-allow</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">spec</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  podSelector</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    matchLabels</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">      app</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> MyApp</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  ingress</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> from</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> ipBlock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        cidr</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.1.0/24</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    ports</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> protocol</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> TCP</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">      port</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 80</span></span></code></pre></div><ol start="2"><li>其他安全措施：</li></ol><ul><li>结合 TLS 终止</li><li>实施速率限制</li><li>启用访问日志</li></ul><h2 id="四、方案对比与选型指南" tabindex="-1"><a class="header-anchor" href="#四、方案对比与选型指南"><span>四、方案对比与选型指南</span></a></h2><h3 id="_4-1-功能对比" tabindex="-1"><a class="header-anchor" href="#_4-1-功能对比"><span>4.1 功能对比</span></a></h3><table><thead><tr><th>特性</th><th>externalIPs</th><th>NodePort</th></tr></thead><tbody><tr><td>IP 管理</td><td>手动配置</td><td>自动分配</td></tr><tr><td>端口范围</td><td>任意端口</td><td>30000-32767</td></tr><tr><td>负载均衡</td><td>需外部实现</td><td>节点间需额外 LB</td></tr><tr><td>云平台兼容性</td><td>较低</td><td>高</td></tr><tr><td>网络要求</td><td>需控制底层网络</td><td>标准网络即可</td></tr></tbody></table><h3 id="_4-2-性能考量" tabindex="-1"><a class="header-anchor" href="#_4-2-性能考量"><span>4.2 性能考量</span></a></h3><ol><li><p><strong>externalIPs</strong>：</p><ul><li>直接路由，延迟较低</li><li>适合高吞吐量场景</li></ul></li><li><p><strong>NodePort</strong>：</p><ul><li>额外 NAT 转换带来小量开销</li><li>节点故障时需要客户端重试</li></ul></li></ol><h3 id="_4-3-选型建议" tabindex="-1"><a class="header-anchor" href="#_4-3-选型建议"><span>4.3 选型建议</span></a></h3><p><strong>选择 externalIPs 当</strong>：</p><ul><li>有严格的 IP 地址要求</li><li>能控制底层网络基础设施</li><li>需要固定知名端口</li><li>在裸金属环境部署</li></ul><p><strong>选择 NodePort 当</strong>：</p><ul><li>需要快速原型开发</li><li>在云环境中运行</li><li>需要与其他服务类型兼容</li><li>作为 Ingress 或 LoadBalancer 的底层机制</li></ul><h2 id="五、生产环境最佳实践" tabindex="-1"><a class="header-anchor" href="#五、生产环境最佳实践"><span>五、生产环境最佳实践</span></a></h2><h3 id="_5-1-混合架构示例" tabindex="-1"><a class="header-anchor" href="#_5-1-混合架构示例"><span>5.1 混合架构示例</span></a></h3><p>结合多种服务类型的典型生产架构：</p><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>外部用户 → 全球负载均衡 → [ 区域LB → NodePort ] → Service → Pod</span></span>
<span class="line"><span>                                  ↑</span></span>
<span class="line"><span>                             externalIPs 备用路径</span></span></code></pre></div><h3 id="_5-2-高可用性设计" tabindex="-1"><a class="header-anchor" href="#_5-2-高可用性设计"><span>5.2 高可用性设计</span></a></h3><ol><li><p><strong>externalIPs 高可用</strong>：</p><ul><li>使用 BGP 协议实现 IP 浮动</li><li>配合 keepalived 实现故障转移</li></ul></li><li><p><strong>NodePort 高可用</strong>：</p><ul><li>部署多个节点</li><li>使用外部健康检查</li><li>自动剔除不健康节点</li></ul></li></ol><h3 id="_5-3-监控与运维" tabindex="-1"><a class="header-anchor" href="#_5-3-监控与运维"><span>5.3 监控与运维</span></a></h3><ol><li><p>关键监控指标：</p><ul><li>连接数</li><li>延迟</li><li>错误率</li><li>节点资源使用率</li></ul></li><li><p>Prometheus 配置示例：</p></li></ol><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">-</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> job_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">nodeport_metrics</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  metrics_path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /metrics</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  static_configs</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> targets</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">node1:31000</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">node2:31000</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span></code></pre></div><h2 id="六、总结" tabindex="-1"><a class="header-anchor" href="#六、总结"><span>六、总结</span></a></h2><p>externalIPs 和 NodePort 都是 Kubernetes 中重要的服务暴露机制，各有其适用场景。理解它们的工作原理、配置细节和适用场景，对于设计可靠的 Kubernetes 网络架构至关重要。在实际应用中，往往需要根据具体的基础设施环境、安全要求和性能需求，选择合适的方案或组合使用多种方案。</p></div><!----><!--[--><h2 id="doc-changelog" tabindex="-1"><a href="#doc-changelog" class="header-anchor"><span>更新日志</span></a></h2><div class="vp-changelog-wrapper"><div class="vp-changelog-header"><div class="vp-latest-updated"><span class="vp-changelog-icon"></span><span data-allow-mismatch>2025/8/13 15:11</span></div><div><span class="vp-changelog-menu-icon"></span><span>查看所有更新日志</span></div></div><ul class="vp-changelog-list"><!--[--><li class="vp-changelog-item-commit"><span class="vp-changelog-hash" target="_blank" rel="noreferrer"><code>b14e6</code></span><span class="vp-changelog-divider">-</span><span class="vp-changelog-message">add calico</span><span class="vp-changelog-date" data-allow-mismatch>于 <time datetime="2025-08-13T15:11:46.000Z">2025/8/13</time></span></li><li class="vp-changelog-item-commit"><span class="vp-changelog-hash" target="_blank" rel="noreferrer"><code>6a272</code></span><span class="vp-changelog-divider">-</span><span class="vp-changelog-message">add calico</span><span class="vp-changelog-date" data-allow-mismatch>于 <time datetime="2025-08-13T13:44:30.000Z">2025/8/13</time></span></li><!--]--></ul></div><!--]--><!----></div></main><footer class="vp-doc-footer" data-v-23f6ad98 data-v-fda6bbae><!--[--><!--]--><!----><div class="contributors" aria-label="Contributors" data-v-fda6bbae><span class="contributors-label" data-v-fda6bbae>贡献者: </span><span class="contributors-info" data-v-fda6bbae><!--[--><!--[--><span class="contributor" data-v-fda6bbae>zhihao</span><!----><!--]--><!--]--></span></div><nav class="prev-next" data-v-fda6bbae><div class="pager" data-v-fda6bbae><a class="vp-link link pager-link prev" href="/k8s/rwl9lg2c/" data-v-fda6bbae><!--[--><span class="desc" data-v-fda6bbae>上一页</span><span class="title" data-v-fda6bbae>kind 常用命令详解</span><!--]--><!----></a></div><div class="pager" data-v-fda6bbae><a class="vp-link link pager-link next" href="/k8s/se02n0mk/" data-v-fda6bbae><!--[--><span class="desc" data-v-fda6bbae>下一页</span><span class="title" data-v-fda6bbae>Kubernetes Webhook 详解与实践</span><!--]--><!----></a></div></nav></footer><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;" data-v-23f6ad98><div style="display: flex;align-items: center;justify-content: center;height: 96px"><span style="--loading-icon: url(&quot;data:image/svg+xml;utf8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; preserveAspectRatio=&#39;xMidYMid&#39; viewBox=&#39;25 25 50 50&#39;%3E%3CanimateTransform attributeName=&#39;transform&#39; type=&#39;rotate&#39; dur=&#39;2s&#39; keyTimes=&#39;0;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;360&#39;%3E%3C/animateTransform%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;20&#39; fill=&#39;none&#39; stroke=&#39;currentColor&#39; stroke-width=&#39;4&#39; stroke-linecap=&#39;round&#39;%3E%3Canimate attributeName=&#39;stroke-dasharray&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;1,200;90,200;1,200&#39;%3E%3C/animate%3E%3Canimate attributeName=&#39;stroke-dashoffset&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;-35px;-125px&#39;%3E%3C/animate%3E%3C/circle%3E%3C/svg%3E&quot;);--icon-size: 48px;display: inline-block;width: var(--icon-size);height: var(--icon-size);background-color: currentcolor;-webkit-mask-image: var(--loading-icon);mask-image: var(--loading-icon)"></span></div></div><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button style="display:none;" type="button" class="vp-back-to-top" aria-label="back to top" data-v-d90a7a26 data-v-bcf8d9a6><span class="percent" data-allow-mismatch data-v-bcf8d9a6>0%</span><span class="show icon vpi-back-to-top" data-v-bcf8d9a6></span><svg aria-hidden="true" data-v-bcf8d9a6><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-bcf8d9a6></circle></svg></button><footer class="vp-footer has-sidebar" vp-footer data-v-d90a7a26 data-v-400675cf><!--[--><div class="container" data-v-400675cf><!----><p class="copyright" data-v-400675cf>to take the days count</p></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-Bx6_S8_t.js" defer></script></body></html>