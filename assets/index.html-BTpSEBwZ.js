import{_ as a,c as i,e as n,o as e}from"./app-DIgjTPbY.js";const p={};function h(t,s){return e(),i("div",null,s[0]||(s[0]=[n(`<p>以下是在 <strong>Multipass</strong> 中创建两台 Ubuntu 虚拟机，并通过 <strong>BIRD</strong> 实现 BGP 路由交换的完整演示步骤：</p><hr><h3 id="_1-创建两台虚拟机" tabindex="-1"><a class="header-anchor" href="#_1-创建两台虚拟机"><span><strong>1. 创建两台虚拟机</strong></span></a></h3><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">multipass</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> launch</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> vm1</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cpus</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --mem</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 1G</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --disk</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 5G</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">multipass</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> launch</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> vm2</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --cpus</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --mem</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 1G</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --disk</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 5G</span></span></code></pre></div><h3 id="_2-安装-bird" tabindex="-1"><a class="header-anchor" href="#_2-安装-bird"><span><strong>2. 安装 BIRD</strong></span></a></h3><p>在两台虚拟机上安装 BIRD（BGP 路由守护进程）：</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 进入 vm1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">multipass</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> shell</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> vm1</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> update</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -y</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bird</span></span></code></pre></div><p>同样在 <code>vm2</code> 上执行相同操作。</p><hr><h3 id="_3-配置-bgp" tabindex="-1"><a class="header-anchor" href="#_3-配置-bgp"><span><strong>3. 配置 BGP</strong></span></a></h3><h4 id="在-vm1-上配置-bird-as-65001" tabindex="-1"><a class="header-anchor" href="#在-vm1-上配置-bird-as-65001"><span><strong>在 vm1 上配置 BIRD（AS 65001）</strong></span></a></h4><p>编辑配置文件 <code>/etc/bird/bird.conf</code>：</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nano</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/bird/bird.conf</span></span></code></pre></div><p>内容如下：</p><div class="language-conf" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-conf"><span class="line"><span>router id 192.168.64.100;  # 使用 vm1 的 IP</span></span>
<span class="line"><span></span></span>
<span class="line"><span>protocol kernel {</span></span>
<span class="line"><span>    scan time 60;</span></span>
<span class="line"><span>    import filter {</span></span>
<span class="line"><span>        if (net = 0.0.0.0/0) then reject;</span></span>
<span class="line"><span>        accept;</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>    export all;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>protocol device {</span></span>
<span class="line"><span>    scan time 60;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>protocol bgp vm2 {</span></span>
<span class="line"><span>    local as 65001;</span></span>
<span class="line"><span>    neighbor 192.168.64.101 as 65002;  # vm2 的 IP 和 AS</span></span>
<span class="line"><span>    import all;</span></span>
<span class="line"><span>    export all;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h4 id="在-vm2-上配置-bird-as-65002" tabindex="-1"><a class="header-anchor" href="#在-vm2-上配置-bird-as-65002"><span><strong>在 vm2 上配置 BIRD（AS 65002）</strong></span></a></h4><p>编辑 <code>/etc/bird/bird.conf</code>：</p><div class="language-conf" data-highlighter="shiki" data-ext="conf" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-conf"><span class="line"><span>router id 192.168.64.101;  # 使用 vm2 的 IP</span></span>
<span class="line"><span></span></span>
<span class="line"><span>protocol kernel {</span></span>
<span class="line"><span>    scan time 60;</span></span>
<span class="line"><span>    import filter {</span></span>
<span class="line"><span>        if (net = 0.0.0.0/0) then reject;</span></span>
<span class="line"><span>        accept;</span></span>
<span class="line"><span>    };</span></span>
<span class="line"><span>    export all;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>protocol device {</span></span>
<span class="line"><span>    scan time 60;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>protocol bgp vm1 {</span></span>
<span class="line"><span>    local as 65002;</span></span>
<span class="line"><span>    neighbor 192.168.64.100 as 65001;  # vm1 的 IP 和 AS</span></span>
<span class="line"><span>    import all;</span></span>
<span class="line"><span>    export all;</span></span>
<span class="line"><span>}</span></span></code></pre></div><hr><h3 id="_4-启动-bird-并验证" tabindex="-1"><a class="header-anchor" href="#_4-启动-bird-并验证"><span><strong>4. 启动 BIRD 并验证</strong></span></a></h3><h4 id="在两台虚拟机上重启-bird" tabindex="-1"><a class="header-anchor" href="#在两台虚拟机上重启-bird"><span><strong>在两台虚拟机上重启 BIRD：</strong></span></a></h4><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bird</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> enable</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bird</span></span></code></pre></div><h4 id="检查-bgp-邻居状态" tabindex="-1"><a class="header-anchor" href="#检查-bgp-邻居状态"><span><strong>检查 BGP 邻居状态：</strong></span></a></h4><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">birdc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> show</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> protocols</span></span></code></pre></div><p>输出应显示 <code>vm2</code> 或 <code>vm1</code> 为 <code>Established</code> 状态。</p><h4 id="测试连通性" tabindex="-1"><a class="header-anchor" href="#测试连通性"><span><strong>测试连通性：</strong></span></a></h4><p>在 <code>vm1</code> 上添加一个测试路由并检查 <code>vm2</code> 是否学习到：</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 在 vm1 上添加测试路由</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> route</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> add</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 10.0.0.0/24</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> via</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 192.168.64.100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 在 vm2 上检查路由表</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> route</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 10.0.0.0</span></span></code></pre></div><hr><h3 id="_5-关键问题排查" tabindex="-1"><a class="header-anchor" href="#_5-关键问题排查"><span><strong>5. 关键问题排查</strong></span></a></h3><ul><li><strong>BGP 邻居未建立</strong>：<br> 检查防火墙是否放行 BGP 端口（TCP 179）：<div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ufw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> allow</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 179/tcp</span></span></code></pre></div></li><li><strong>路由未同步</strong>：<br> 确保 <code>protocol kernel</code> 中配置了 <code>export all</code>。</li></ul><hr><h3 id="效果图" tabindex="-1"><a class="header-anchor" href="#效果图"><span><strong>效果图</strong></span></a></h3><div class="language-" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-"><span class="line"><span>vm1 (AS65001) ↔ BGP ↔ vm2 (AS65002)</span></span>
<span class="line"><span>  192.168.64.100     192.168.64.101</span></span></code></pre></div><p>通过此配置，两台虚拟机将通过 BGP 动态交换路由表。你可以扩展此实验（如添加 OSPF 或更多邻居）。</p><p>也可直接参考官方docker演示：https://packetfire.org/post/intro-to-bgp/</p>`,36)]))}const r=a(p,[["render",h]]),d=JSON.parse('{"path":"/k8s/eigpt0xy/","title":"🐦‍🔥Bird的使用","lang":"zh-CN","frontmatter":{"title":"🐦‍🔥Bird的使用","createTime":"2025/08/13 16:37:20","permalink":"/k8s/eigpt0xy/","description":"以下是在 Multipass 中创建两台 Ubuntu 虚拟机，并通过 BIRD 实现 BGP 路由交换的完整演示步骤： 1. 创建两台虚拟机 2. 安装 BIRD 在两台虚拟机上安装 BIRD（BGP 路由守护进程）： 同样在 vm2 上执行相同操作。 3. 配置 BGP 在 vm1 上配置 BIRD（AS 65001） 编辑配置文件 /etc/bi...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"🐦‍🔥Bird的使用\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-08-13T15:11:46.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://blog.jianzhihao.icu/k8s/eigpt0xy/"}],["meta",{"property":"og:site_name","content":"ZH Blog"}],["meta",{"property":"og:title","content":"🐦‍🔥Bird的使用"}],["meta",{"property":"og:description","content":"以下是在 Multipass 中创建两台 Ubuntu 虚拟机，并通过 BIRD 实现 BGP 路由交换的完整演示步骤： 1. 创建两台虚拟机 2. 安装 BIRD 在两台虚拟机上安装 BIRD（BGP 路由守护进程）： 同样在 vm2 上执行相同操作。 3. 配置 BGP 在 vm1 上配置 BIRD（AS 65001） 编辑配置文件 /etc/bi..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-13T15:11:46.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-13T15:11:46.000Z"}]]},"readingTime":{"minutes":1.56,"words":467},"git":{"createdTime":1755081762000,"updatedTime":1755097906000,"contributors":[{"name":"Jian Zhihao","username":"","email":"zhihao.kan17@gmail.com","commits":1,"avatar":"https://gravatar.com/avatar/e1544e07aafff26d45ab40aff0c37757b708b7bab4afcdb1fc4b1ffcb6b9edc1?d=retro"},{"name":"zhihao","username":"zhihao","email":"mac@zhihaomac.local","commits":1,"avatar":"https://avatars.githubusercontent.com/zhihao?v=4","url":"https://github.com/zhihao"}],"changelog":[{"hash":"b14e6181535ae1948c566c3579bb41b2ebd924aa","time":1755097906000,"email":"mac@zhihaomac.local","author":"zhihao","message":"add calico"},{"hash":"0665253be62e41d105b50ba524ff77fff218b609","time":1755081762000,"email":"zhihao.kan17@gmail.com","author":"Jian Zhihao","message":"add bird"}]},"autoDesc":true,"filePathRelative":"notes/k8s/2. 网络/Calico/1.Bird的使用.md","headers":[]}');export{r as comp,d as data};
