import{_ as n,c as h,e as i,b as t,r as k,o as l}from"./app-Bx6_S8_t.js";const p={};function e(d,s){const a=k("Mermaid");return l(),h("div",null,[s[0]||(s[0]=i('<h2 id="_1-引言-kubernetes-网络模型与-cni-的诞生" tabindex="-1"><a class="header-anchor" href="#_1-引言-kubernetes-网络模型与-cni-的诞生"><span>1. 引言：Kubernetes 网络模型与 CNI 的诞生</span></a></h2><p>Kubernetes 设计了一套简洁而强大的网络模型，要求所有容器运行时必须满足四个基本条件：</p><ol><li>Pod 拥有唯一IP且可直接通信</li><li>Pod 能通过Service IP访问服务</li><li>节点能与所有Pod直接通信</li><li>HostNetwork模式下的Pod能与集群网络互通</li></ol><p>为实现这一模型而诞生的<strong>容器网络接口（CNI）</strong>，提供了一个标准化的插件框架，让不同的网络解决方案能够在Kubernetes中无缝工作。CNI定义了容器运行时与网络插件之间的契约，使得网络配置变得模块化和可扩展。</p><h2 id="_2-cni-插件的基本工作原理" tabindex="-1"><a class="header-anchor" href="#_2-cni-插件的基本工作原理"><span>2. CNI 插件的基本工作原理</span></a></h2><h3 id="_2-1-调用流程-从kubelet到网络插件" tabindex="-1"><a class="header-anchor" href="#_2-1-调用流程-从kubelet到网络插件"><span>2.1 调用流程：从Kubelet到网络插件</span></a></h3><p>Kubernetes并不直接管理网络，而是通过一个清晰的调用链委托处理：</p>',7)),t(a,{code:"eJyFkc1OwkAUhfc8xSw1kbhnYWLQRa1WIk9QYaJNtMVajEv/IUYEgcQfKkHDAmMCmCgKCLwMd4a+hTMdAkaszmaSud+9c865u3gnjvUIXtDUDVPd9iF2YqppaREtpuoWkpG6i+T4Ot7C1kQxyItQbcJtZdDLDB4uyHVjKmLolqrp2IzOBtck/+r0ZJsi8UZ2kXS2325MAFJofoUT/PZAFGxxYlnT4/u0c0XbNiklfS6mGBZGxh42kTzDuQAKGVFIFqDdcm4apPrmUrJ/bi4YQExiAK3FdYaEVT26buwPau/k5chlgoIRveTuCA5t4XaW4eJXuOpAJkWfWs7167hHYUMH1S7tVOllDR6PIX3jJNLQbPQ/S85Bdim8qjinKVYWLYrEmrhZ1lU/pvnK2DgkzxgphVyQP/tH83t5KBRFnd6dSCGw63B/8G2i612I38PWJstPMyF7IYQzeVBOjGjhVMwUgBBI2zlStIfOGCT/FhnkUtDKT0Hmmb0xlWLlfy2j5NyWPZYRtoyY9zZc525GC4vLJJfqd2zycUozZ0L0RJ5O4pzku97hcCH/BjL8wSsKvM0M/kzD9wVKqnSe"}),s[1]||(s[1]=i(`<h3 id="_2-2-插件调用机制" tabindex="-1"><a class="header-anchor" href="#_2-2-插件调用机制"><span>2.2 插件调用机制</span></a></h3><p>容器运行时通过两种方式向CNI插件传递信息：</p><ol><li><strong>环境变量</strong>：提供执行上下文</li></ol><ul><li><code>CNI_COMMAND</code>：操作类型(ADD/DEL/CHECK/VERSION)</li><li><code>CNI_CONTAINERID</code>：容器唯一标识符</li><li><code>CNI_NETNS</code>：Pod网络命名空间路径</li><li><code>CNI_IFNAME</code>：Pod内容器接口名(通常为eth0)</li><li><code>CNI_PATH</code>：CNI插件搜索路径</li></ul><ol start="2"><li><strong>标准输入(stdin)</strong>：传递JSON格式的完整配置信息</li></ol><h2 id="_3-cni-插件的三种类型与链式调用" tabindex="-1"><a class="header-anchor" href="#_3-cni-插件的三种类型与链式调用"><span>3. CNI 插件的三种类型与链式调用</span></a></h2><p>CNI生态系统由三类插件组成，它们通过链式调用协同工作。</p><h3 id="_3-1-主插件-main-plugins" tabindex="-1"><a class="header-anchor" href="#_3-1-主插件-main-plugins"><span>3.1 主插件(Main Plugins)</span></a></h3><p>负责数据通路的建立，是网络配置的核心：</p><ul><li><strong>功能</strong>：创建虚拟网络设备(veth pair、网桥、隧道等)，配置设备状态</li><li><strong>示例</strong>：<code>bridge</code>、<code>macvlan</code>、<code>ipvlan</code>、<code>vlan</code>，以及Calico、Flannel等实现的插件</li></ul><h3 id="_3-2-ipam插件-ip-address-management-plugins" tabindex="-1"><a class="header-anchor" href="#_3-2-ipam插件-ip-address-management-plugins"><span>3.2 IPAM插件(IP Address Management Plugins)</span></a></h3><p>负责IP地址的分配和管理：</p><ul><li><strong>功能</strong>：从地址池中分配空闲IP，记录分配状态，回收IP地址</li><li><strong>示例</strong>：<code>host-local</code>(本地文件管理)、<code>dhcp</code>(DHCP服务器分配)</li></ul><h3 id="_3-3-meta插件-meta-plugins" tabindex="-1"><a class="header-anchor" href="#_3-3-meta插件-meta-plugins"><span>3.3 Meta插件(meta Plugins)</span></a></h3><p>编排和修饰其他插件，增强网络功能：</p><ul><li><strong>功能</strong>：控制插件链执行流程，修改网络配置</li><li><strong>示例</strong>： <ul><li><code>portmap</code>：提供HostPort功能，通过iptables实现端口映射</li><li><code>bandwidth</code>：使用tc命令限制网络带宽</li><li><code>tuning</code>：调整网络接口参数(MTU、sysctl等)</li><li><code>flannel</code>：特殊meta插件，根据集群状态生成配置并调用其他插件</li></ul></li></ul><h3 id="_3-4-插件链示例" tabindex="-1"><a class="header-anchor" href="#_3-4-插件链示例"><span>3.4 插件链示例</span></a></h3><div class="language-json" data-highlighter="shiki" data-ext="json" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cniVersion</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">0.4.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mynet</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">plugins</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">      &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">type</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">bridge</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">      &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">bridge</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">cni0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">      &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">ipam</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">        &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">type</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">host-local</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">        &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">subnet</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">10.244.0.0/24</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    },</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">      &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">type</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">portmap</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">      &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">capabilities</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">portMappings</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    },</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">      &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">type</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">bandwidth</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">      &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">capabilities</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">bandwidth</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  ]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><h2 id="_4-cni-插件可获取的信息详情" tabindex="-1"><a class="header-anchor" href="#_4-cni-插件可获取的信息详情"><span>4. CNI 插件可获取的信息详情</span></a></h2><h3 id="_4-1-通过环境变量获取的信息" tabindex="-1"><a class="header-anchor" href="#_4-1-通过环境变量获取的信息"><span>4.1 通过环境变量获取的信息</span></a></h3><table><thead><tr><th>变量名</th><th>描述</th><th>示例值</th></tr></thead><tbody><tr><td><code>CNI_COMMAND</code></td><td>要执行的操作</td><td><code>ADD</code>, <code>DEL</code>, <code>CHECK</code></td></tr><tr><td><code>CNI_CONTAINERID</code></td><td>容器唯一ID</td><td><code>a1b2c3d4...</code></td></tr><tr><td><code>CNI_NETNS</code></td><td>网络命名空间路径</td><td><code>/proc/12345/ns/net</code></td></tr><tr><td><code>CNI_IFNAME</code></td><td>容器内接口名</td><td><code>eth0</code></td></tr><tr><td><code>CNI_PATH</code></td><td>插件搜索路径</td><td><code>/opt/cni/bin</code></td></tr></tbody></table><h3 id="_4-2-通过标准输入获取的信息" tabindex="-1"><a class="header-anchor" href="#_4-2-通过标准输入获取的信息"><span>4.2 通过标准输入获取的信息</span></a></h3><div class="language-json" data-highlighter="shiki" data-ext="json" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-json"><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cniVersion</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">0.4.0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">name</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mybridge</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">type</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">bridge</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">bridge</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">cni0</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">ipam</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">type</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">host-local</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;"> &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">subnet</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">10.244.0.0/24</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">},</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">args</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">K8S_POD_NAMESPACE</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">my-namespace</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">K8S_POD_NAME</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">nginx-55f5c6d859-abcde</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">K8S_POD_UID</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">a1b2c3d4-5678-90ef-...</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">K8S_POD_INFRA_CONTAINER_ID</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">containerd://a1b2c3d4...</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  },</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">runtimeConfig</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">org.example.cni</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">ip</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">10.244.0.123</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  },</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">  &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">prevResult</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">ips</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [{</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">address</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">10.244.0.123/24</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}],</span></span>
<span class="line"><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">    &quot;</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">interfaces</span><span style="--shiki-light:#99841877;--shiki-dark:#B8A96577;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre></div><p><strong>关键数据字段：</strong></p><ul><li><strong>网络配置</strong>：插件类型、网桥名、IPAM策略等</li><li><strong>Kubernetes元数据</strong>：Pod名称、命名空间、UID等（通过<code>args</code>字段）</li><li><strong>运行时配置</strong>：CRI运行时覆盖的配置参数</li><li><strong>先前结果</strong>：用于DEL操作或插件链中后续插件的上一次执行结果</li></ul><h2 id="_5-编写一个简单的cni插件" tabindex="-1"><a class="header-anchor" href="#_5-编写一个简单的cni插件"><span>5. 编写一个简单的CNI插件</span></a></h2><p>以下是一个简易的bash版CNI插件示例，演示了插件的基本结构：</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 读取环境变量</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">COMMAND</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">$CNI_COMMAND</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">NETNS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">$CNI_NETNS</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CONTAINER_ID</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">$CNI_CONTAINERID</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 从标准输入读取配置</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">CONFIG</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=$(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cat</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /dev/stdin</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">NETWORK_NAME</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=$(</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $CONFIG</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> jq</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -r</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.name</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">BRIDGE_NAME</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=$(</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $CONFIG</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> jq</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -r</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.bridge</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 提取Kubernetes信息（如果存在）</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">K8S_POD_NAMESPACE</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=$(</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $CONFIG</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> jq</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -r</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.args.K8S_POD_NAMESPACE // empty</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">K8S_POD_NAME</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=$(</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $CONFIG</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> jq</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -r</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.args.K8S_POD_NAME // empty</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">case</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $COMMAND</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> in</span></span>
<span class="line"><span style="--shiki-light:#AB5E3F;--shiki-dark:#C4704F;">ADD</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 调用IPAM插件分配IP</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    IPAM_RESULT</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=$(</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $CONFIG</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> /opt/cni/bin/host-local</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    POD_IP</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=$(</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">echo</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $IPAM_RESULT</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> jq</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -r</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.ips[0].address</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 记录日志（包含Kubernetes信息）</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [[</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> -n</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">$K8S_POD_NAMESPACE</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> ]];</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> then</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Configuring network for Pod: $K8S_POD_NAMESPACE/$K8S_POD_NAME</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;&amp;2</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    fi</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 创建网络设备</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    ip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> link</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> add</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> veth0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> type</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> veth</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> peer</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> eth0</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    ip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> link</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> veth0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> master</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $BRIDGE_NAME</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    ip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> link</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> veth0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> up</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    ip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> link</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> eth0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> netns</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $NETNS</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    ip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> netns</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $NETNS</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> addr</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> add</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $POD_IP</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dev</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> eth0</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    ip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> netns</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $NETNS</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> link</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> eth0</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> up</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    echo</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $IPAM_RESULT</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    ;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5E3F;--shiki-dark:#C4704F;">DEL</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 清理网络资源</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    echo</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> $CONFIG</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> /opt/cni/bin/host-local</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 这里需要更复杂的逻辑来查找和删除veth设备</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    ;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5E3F;--shiki-dark:#C4704F;">VERSION</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">{&quot;cniVersion&quot;: &quot;0.4.0&quot;, &quot;supportedVersions&quot;: [&quot;0.3.0&quot;, &quot;0.3.1&quot;, &quot;0.4.0&quot;]}</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    ;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*)</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    echo</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Unknown CNI_COMMAND: $COMMAND</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &gt;&amp;2</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    exit</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    ;;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">esac</span></span></code></pre></div><h2 id="_6-高级主题与生产实践" tabindex="-1"><a class="header-anchor" href="#_6-高级主题与生产实践"><span>6. 高级主题与生产实践</span></a></h2><h3 id="_6-1-多节点网络实现" tabindex="-1"><a class="header-anchor" href="#_6-1-多节点网络实现"><span>6.1 多节点网络实现</span></a></h3><p>单节点插件只能实现节点内Pod通信，多节点通信需要：</p><ul><li><strong>Overlay网络</strong>：使用VXLAN、IPsec等隧道技术封装Pod流量</li><li><strong>路由方案</strong>：通过BGP协议或云平台路由表实现跨节点路由</li><li><strong>网络策略</strong>：使用Calico、Cilium等插件实现基于命名空间和Pod标签的精细网络策略</li></ul><h3 id="_6-2-生产环境考量" tabindex="-1"><a class="header-anchor" href="#_6-2-生产环境考量"><span>6.2 生产环境考量</span></a></h3><ul><li><strong>性能</strong>：选择数据平面性能高的插件（如Calico的BPF模式、Cilium）</li><li><strong>可靠性</strong>：确保网络控制平面的高可用性</li><li><strong>安全性</strong>：实施网络策略，实现最小权限原则</li><li><strong>可观测性</strong>：集成监控、日志和追踪功能</li><li><strong>维护性</strong>：选择有活跃社区支持和良好文档的CNI插件</li></ul><h2 id="_7-总结" tabindex="-1"><a class="header-anchor" href="#_7-总结"><span>7. 总结</span></a></h2><p>Kubernetes CNI插件体系通过标准化的接口和模块化的设计，将复杂的容器网络问题分解为可管理的组件。主插件、IPAM插件和Meta插件各司其职，通过链式调用协同工作，为容器提供灵活、强大的网络能力。</p>`,36))])}const g=n(p,[["render",e]]),y=JSON.parse('{"path":"/k8s/tvrhac3r/","title":"kubelet与cni","lang":"zh-CN","frontmatter":{"title":"kubelet与cni","createTime":"2025/08/24 22:32:16","permalink":"/k8s/tvrhac3r/","description":"1. 引言：Kubernetes 网络模型与 CNI 的诞生 Kubernetes 设计了一套简洁而强大的网络模型，要求所有容器运行时必须满足四个基本条件： Pod 拥有唯一IP且可直接通信 Pod 能通过Service IP访问服务 节点能与所有Pod直接通信 HostNetwork模式下的Pod能与集群网络互通 为实现这一模型而诞生的容器网络接口（...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"kubelet与cni\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-08-24T15:02:34.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://blog.jianzhihao.icu/k8s/tvrhac3r/"}],["meta",{"property":"og:site_name","content":"ZH Blog"}],["meta",{"property":"og:title","content":"kubelet与cni"}],["meta",{"property":"og:description","content":"1. 引言：Kubernetes 网络模型与 CNI 的诞生 Kubernetes 设计了一套简洁而强大的网络模型，要求所有容器运行时必须满足四个基本条件： Pod 拥有唯一IP且可直接通信 Pod 能通过Service IP访问服务 节点能与所有Pod直接通信 HostNetwork模式下的Pod能与集群网络互通 为实现这一模型而诞生的容器网络接口（..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-24T15:02:34.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-24T15:02:34.000Z"}]]},"readingTime":{"minutes":5.27,"words":1581},"git":{"createdTime":1756047754000,"updatedTime":1756047754000,"contributors":[{"name":"zhihao","username":"zhihao","email":"zhihao.kan17@gmail.com","commits":1,"avatar":"https://avatars.githubusercontent.com/zhihao?v=4","url":"https://github.com/zhihao"}],"changelog":[{"hash":"c2df62a1f29f2831958c4f15ba54a8e5c8a6033c","time":1756047754000,"email":"zhihao.kan17@gmail.com","author":"zhihao","message":"add kubelet cni"}]},"autoDesc":true,"filePathRelative":"notes/k8s/2. 网络/1.网络插件基础/2.kubelet与cni.md","headers":[]}');export{g as comp,y as data};
