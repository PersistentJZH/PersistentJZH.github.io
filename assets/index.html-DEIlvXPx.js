import{_ as e,c as n,e as s,o as r}from"./app-Bx6_S8_t.js";const l={};function a(o,t){return r(),n("div",null,t[0]||(t[0]=[s('<h3 id="_1-金丝雀发布" tabindex="-1"><a class="header-anchor" href="#_1-金丝雀发布"><span>1. 金丝雀发布</span></a></h3><h4 id="核心思想" tabindex="-1"><a class="header-anchor" href="#核心思想"><span>核心思想</span></a></h4><p><strong>渐进式、受控的发布</strong>。就像矿工下井前先放一只金丝雀来探测有毒气体一样，这种策略先将新版本应用部署给一小部分用户（例如 1%、5% 或 10%），在真实生产环境中进行“测试”。如果一切正常，再逐步扩大用户范围，直到完全替换旧版本。如果发现问题，则立即回滚，影响范围很小。</p><h4 id="工作流程" tabindex="-1"><a class="header-anchor" href="#工作流程"><span>工作流程</span></a></h4><ol><li><strong>初始状态</strong>： 100% 的用户流量都指向稳定运行的旧版本（v1）。</li><li><strong>发布金丝雀</strong>： 部署新版本（v2），但先不接收用户流量。通过负载均衡器或服务网格（如 Istio、Nginx）的规则，将一小部分特定用户（如内部员工、特定地区用户或随机选择的用户）的流量引导到 v2。</li><li><strong>观察与监控</strong>： 密切监控 v2 的运行状态，包括业务指标（如订单成功率、响应时间）和技术指标（如 CPU 使用率、错误率）。</li><li><strong>决策点</strong>： <ul><li><strong>成功</strong>： 如果金丝雀版本运行稳定，指标健康，则逐步扩大流向 v2 的流量比例（例如 10% -&gt; 25% -&gt; 50% -&gt; 100%）。</li><li><strong>失败</strong>： 如果发现任何问题，立即将全部流量切回 v1，并下线有问题的 v2 版本。由于只影响了一小部分用户，所以整体风险很低。</li></ul></li><li><strong>完成发布</strong>： 当 100% 的流量都切换到 v2 并稳定运行一段时间后，下线 v1 版本。</li></ol><h4 id="优点" tabindex="-1"><a class="header-anchor" href="#优点"><span>优点</span></a></h4><ul><li><strong>风险极低</strong>： 问题在影响大面积用户前就能被发现和修复。</li><li><strong>实时验证</strong>： 在真实用户环境和流量下进行测试，结果更可靠。</li><li><strong>平滑过渡</strong>： 对用户影响小，几乎无感知。</li></ul><h4 id="缺点" tabindex="-1"><a class="header-anchor" href="#缺点"><span>缺点</span></a></h4><ul><li><strong>发布周期稍长</strong>： 需要逐步扩大流量，比一次性全量发布要慢。</li><li><strong>部署复杂性高</strong>： 需要复杂的流量控制工具（如服务网格）和完善的监控告警体系。</li><li><strong>需要维护两个版本</strong>： 在发布期间，需要同时维护 v1 和 v2 的兼容性。</li></ul><hr><h3 id="_2-蓝绿发布" tabindex="-1"><a class="header-anchor" href="#_2-蓝绿发布"><span>2. 蓝绿发布</span></a></h3><h4 id="核心思想-1" tabindex="-1"><a class="header-anchor" href="#核心思想-1"><span>核心思想</span></a></h4><p><strong>切换、而非渐进</strong>。同时部署两个完全相同的生产环境：“蓝色”和“绿色”。</p><ul><li>一个环境（比如蓝色）承载当前所有的生产流量。</li><li>另一个环境（绿色）部署新版本。</li></ul><p>测试无误后，通过一次性切换负载均衡器的配置，将所有用户流量从蓝色环境瞬间切换到绿色环境。如果绿色环境出现问题，再瞬间切回蓝色环境。</p><h4 id="工作流程-1" tabindex="-1"><a class="header-anchor" href="#工作流程-1"><span>工作流程</span></a></h4><ol><li><strong>初始状态</strong>： “蓝色”环境（v1）正在服务所有用户。“绿色”环境空闲或运行着与蓝色相同的版本。</li><li><strong>部署新版本</strong>： 在“绿色”环境中部署新版本（v2），并进行充分的测试（集成测试、API测试等）。此时，真实用户流量仍在蓝色环境。</li><li><strong>最终测试</strong>： 在将流量切换到绿色环境之前，可以进行最终的健康检查。</li><li><strong>切换流量</strong>： 通过更改路由器、负载均衡器或 DNS 的配置，将所有生产流量从蓝色环境<strong>一次性、瞬间</strong>切换到绿色环境。</li><li><strong>观察与监控</strong>： 密切监控绿色环境的运行状态。</li><li><strong>决策点</strong>： <ul><li><strong>成功</strong>： 绿色环境运行稳定，则蓝色环境可以下线，作为下一次发布的“绿色”环境。</li><li><strong>失败</strong>： 如果绿色环境出现问题，立即将流量全部切回蓝色环境。回滚非常快速，几乎零停机。</li></ul></li></ol><h4 id="优点-1" tabindex="-1"><a class="header-anchor" href="#优点-1"><span>优点</span></a></h4><ul><li><strong>快速回滚</strong>： 版本切换和回滚速度极快，只需改变路由配置。</li><li><strong>风险隔离</strong>： 新旧环境完全隔离，避免了版本间相互影响。</li><li><strong>发布和回滚过程简单明了</strong>。</li><li><strong>真正零停机发布</strong>。</li></ul><h4 id="缺点-1" tabindex="-1"><a class="header-anchor" href="#缺点-1"><span>缺点</span></a></h4><ul><li><strong>资源成本高</strong>： 需要维护两套完全相同的硬件/基础设施资源，成本是两倍。</li><li><strong>对数据兼容性要求高</strong>： 在切换期间，两个环境连接的如果是同一个数据库，必须确保数据库 schema 和数据的双向兼容性，否则回滚时会出问题。</li><li><strong>切换是“非黑即白”的</strong>： 无法像金丝雀发布那样进行灰度验证，所有用户同时体验新版本。</li></ul><hr><h3 id="对比总结" tabindex="-1"><a class="header-anchor" href="#对比总结"><span>对比总结</span></a></h3><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">金丝雀发布</th><th style="text-align:left;">蓝绿发布</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>核心思想</strong></td><td style="text-align:left;"><strong>渐进式</strong>流量切换</td><td style="text-align:left;"><strong>一次性</strong>环境切换</td></tr><tr><td style="text-align:left;"><strong>发布速度</strong></td><td style="text-align:left;">较慢，逐步推进</td><td style="text-align:left;">极快，瞬间完成</td></tr><tr><td style="text-align:left;"><strong>回滚速度</strong></td><td style="text-align:left;">较快，逐步缩流</td><td style="text-align:left;"><strong>极快</strong>，一键切换</td></tr><tr><td style="text-align:left;"><strong>资源成本</strong></td><td style="text-align:left;">较低，只需额外部署部分实例</td><td style="text-align:left;"><strong>高</strong>，需要两套完整环境</td></tr><tr><td style="text-align:left;"><strong>风险控制</strong></td><td style="text-align:left;"><strong>极好</strong>，影响范围小</td><td style="text-align:left;">好，但切换是全量的</td></tr><tr><td style="text-align:left;"><strong>复杂性</strong></td><td style="text-align:left;">高（需要精细流量控制）</td><td style="text-align:left;">中（主要是基础设施和路由）</td></tr><tr><td style="text-align:left;"><strong>适用场景</strong></td><td style="text-align:left;">面向用户的应用，需要验证业务逻辑</td><td style="text-align:left;">基础设施、中间件或对回滚速度要求极高的应用</td></tr></tbody></table><h3 id="如何选择" tabindex="-1"><a class="header-anchor" href="#如何选择"><span>如何选择？</span></a></h3><ul><li><strong>选择金丝雀发布</strong>： 当你非常关注新版本的<strong>稳定性和业务影响</strong>，希望用真实流量进行渐进式验证，并且能够接受较长的发布周期时。例如：电商网站的前端UI、核心交易链路。</li><li><strong>选择蓝绿发布</strong>： 当你追求<strong>发布和回滚的绝对速度</strong>，并且资源预算充足，或者应用本身对基础设施的依赖性很强时。例如：数据库升级、核心中间件、API网关。</li></ul><p>在实际生产中，这两种策略也常常结合使用。例如，先采用蓝绿发布搭建好新环境，然后在切换流量时，不使用一次性全量切换，而是采用金丝雀发布的方式逐步将流量从蓝色环境迁移到绿色环境，从而兼具两种策略的优点。</p>',27)]))}const g=e(l,[["render",a]]),d=JSON.parse('{"path":"/k8s/egsg3eyn/","title":"发布类型","lang":"zh-CN","frontmatter":{"title":"发布类型","createTime":"2025/11/04 14:28:51","permalink":"/k8s/egsg3eyn/","description":"1. 金丝雀发布 核心思想 渐进式、受控的发布。就像矿工下井前先放一只金丝雀来探测有毒气体一样，这种策略先将新版本应用部署给一小部分用户（例如 1%、5% 或 10%），在真实生产环境中进行“测试”。如果一切正常，再逐步扩大用户范围，直到完全替换旧版本。如果发现问题，则立即回滚，影响范围很小。 工作流程 初始状态： 100% 的用户流量都指向稳定运行的...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"发布类型\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-11-04T08:11:10.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://blog.jianzhihao.icu/k8s/egsg3eyn/"}],["meta",{"property":"og:site_name","content":"ZH Blog"}],["meta",{"property":"og:title","content":"发布类型"}],["meta",{"property":"og:description","content":"1. 金丝雀发布 核心思想 渐进式、受控的发布。就像矿工下井前先放一只金丝雀来探测有毒气体一样，这种策略先将新版本应用部署给一小部分用户（例如 1%、5% 或 10%），在真实生产环境中进行“测试”。如果一切正常，再逐步扩大用户范围，直到完全替换旧版本。如果发现问题，则立即回滚，影响范围很小。 工作流程 初始状态： 100% 的用户流量都指向稳定运行的..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-04T08:11:10.000Z"}],["meta",{"property":"article:modified_time","content":"2025-11-04T08:11:10.000Z"}]]},"readingTime":{"minutes":5.03,"words":1509},"git":{"createdTime":1762243870000,"updatedTime":1762243870000,"contributors":[{"name":"PersistentJZH","username":"PersistentJZH","email":"zhihao.kan17@gmail.com","commits":1,"avatar":"https://avatars.githubusercontent.com/PersistentJZH?v=4","url":"https://github.com/PersistentJZH"}],"changelog":[{"hash":"295dd2bc5f36ec49b72f339d819850b9dd1c2c55","time":1762243870000,"email":"zhihao.kan17@gmail.com","author":"PersistentJZH","message":"add canary"}]},"autoDesc":true,"filePathRelative":"notes/k8s/4. k8s增强/kruise-rollout/发布类型.md","headers":[]}');export{g as comp,d as data};
