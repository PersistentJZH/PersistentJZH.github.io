import{_ as i,c as a,e,o as t}from"./app-Bx6_S8_t.js";const h="/assets/architecture-calico-deae813300e472483f84d6bfb49650ab-CTuW2vRC.svg",n={};function l(d,s){return t(),a("div",null,s[0]||(s[0]=[e('<p>åœ¨ Calicoï¼ˆæˆ–åŸºäº BGP çš„ç½‘ç»œæ¶æ„ï¼‰ä¸­ï¼Œè·¯ç”±å®£å‘Šçš„è§¦å‘æ¡ä»¶ä¸ç½‘ç»œæ‹“æ‰‘å˜åŒ–ã€ç­–ç•¥è°ƒæ•´æˆ–ç³»ç»Ÿäº‹ä»¶å¯†åˆ‡ç›¸å…³ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åœºæ™¯åˆ†æåŠè§¦å‘æœºåˆ¶ï¼š</p><hr><h2 id="_1-calicoæ¶æ„å›¾" tabindex="-1"><a class="header-anchor" href="#_1-calicoæ¶æ„å›¾"><span><strong>1. Calicoæ¶æ„å›¾</strong></span></a></h2><img src="'+h+`" class="no-view"><hr><table><thead><tr><th><strong>ç»„ä»¶</strong></th><th><strong>å­æ¨¡å—/æ–‡ä»¶</strong></th><th><strong>æ ¸å¿ƒåŠŸèƒ½</strong></th><th><strong>é…ç½®å‚æ•°ç¤ºä¾‹</strong></th><th><strong>äº¤äº’ç»„ä»¶</strong></th><th><strong>å…¸å‹å·¥ä½œåœºæ™¯</strong></th></tr></thead><tbody><tr><td><strong>Felix</strong></td><td><code>felix.cfg</code></td><td>- ç®¡ç†èŠ‚ç‚¹æœ¬åœ°è·¯ç”±è¡¨ (<code>route table</code>) <br>- é…ç½®iptables/eBPFè§„åˆ™é“¾ (<code>cali-INPUT</code>, <code>cali-FORWARD</code>ç­‰) <br>- å®æ–½ç½‘ç»œç­–ç•¥ï¼ˆæ ‡è®°æµé‡<code>allow/deny</code>ï¼‰</td><td><code>RouteRefreshInterval=10s</code> <br><code>MetadataAddr=127.0.0.1</code> <br><code>IptablesMarkMask=0xff000000</code></td><td>BIRD, etcd/K8s API, Typha</td><td>Podåˆ›å»ºæ—¶è‡ªåŠ¨æ·»åŠ è·¯ç”±è§„åˆ™ï¼›ç­–ç•¥æ›´æ–°æ—¶å®æ—¶ç”Ÿæ•ˆ</td></tr><tr><td><strong>BIRD</strong></td><td><code>bird.cfg</code> (ç”±confdç”Ÿæˆ)</td><td>- é€šè¿‡BGPåè®®å¹¿æ’­æœ¬èŠ‚ç‚¹Pod CIDRï¼ˆå¦‚<code>10.0.1.0/24</code>ï¼‰<br>- å­¦ä¹ å…¶ä»–èŠ‚ç‚¹çš„è·¯ç”±ï¼ˆ<code>via Node2</code>ï¼‰</td><td><code>protocol bgp { local as 64512; neighbor 192.168.1.2 as 64512; }</code></td><td>Felix, Route Reflector</td><td>æ–°èŠ‚ç‚¹åŠ å…¥æ—¶è‡ªåŠ¨å»ºç«‹BGPå¯¹ç­‰è¿æ¥</td></tr><tr><td><strong>Calico CNI Plugin</strong></td><td><code>10-calico.conflist</code></td><td>- è°ƒç”¨IPAMæ’ä»¶åˆ†é…Pod IP<br>- åˆ›å»ºveth pair (<code>caliXXXXX</code>)<br>- è®¾ç½®Podç½‘ç»œå‘½åç©ºé—´è·¯ç”±</td><td><code>&quot;ipam&quot;: { &quot;type&quot;: &quot;calico-ipam&quot;, &quot;subnet&quot;: &quot;usePodCidr&quot; }</code></td><td>kubelet, IPAM, Felix</td><td><code>kubectl run</code>æ—¶è¢«kubeletè°ƒç”¨ï¼Œå®ŒæˆPodç½‘ç»œé…ç½®</td></tr><tr><td><strong>calico-kube-controllers</strong></td><td><code>policy-controller</code></td><td>- ç›‘å¬K8s <code>NetworkPolicy</code>å¹¶åŒæ­¥åˆ°Felix<br>- æ¸…ç†å­¤å„¿IPåœ°å€ï¼ˆ<code>IPGC</code>ï¼‰<br>- ç»´æŠ¤èŠ‚ç‚¹å¿ƒè·³</td><td><code>controllers: node, policy, serviceaccount</code></td><td>K8s API Server, etcd</td><td>ç”¨æˆ·åˆ›å»º<code>NetworkPolicy</code>æ—¶ï¼Œè½¬æ¢ä¸ºCalicoæ ¼å¼å¹¶ä¸‹å‘</td></tr><tr><td><strong>Typha</strong></td><td><code>typha-deployment.yaml</code></td><td>- ä»£ç†Felixçš„APIè¯·æ±‚ï¼ˆç¼“å­˜<code>Nodes</code>, <code>Policies</code>ï¼‰<br>- å‡å°‘API Serverè´Ÿè½½ï¼ˆè¿æ¥æ•°ä»O(N)â†’O(1)ï¼‰</td><td><code>maxConnsPerClient=4</code> <br><code>clientPort=5473</code></td><td>Felix, K8s API</td><td>é›†ç¾¤è¶…è¿‡50èŠ‚ç‚¹æ—¶ï¼ŒFelixé€šè¿‡Typhaè·å–ç­–ç•¥è€Œéç›´è¿API</td></tr><tr><td><strong>Route Reflector</strong></td><td><code>bgpconfiguration.yaml</code></td><td>- é›†ä¸­å¼è·¯ç”±åˆ†å‘ï¼ˆæ›¿ä»£å…¨äº’è”ï¼‰<br>- æ”¯æŒé›†ç¾¤ASå·ï¼ˆ<code>AS 64512</code>ï¼‰å’Œè·¯ç”±èšåˆ</td><td><code>routeReflectorClusterID: 1.0.0.1</code> <br><code>logSeverityScreen: Info</code></td><td>BIRD (æ‰€æœ‰èŠ‚ç‚¹)</td><td>è·¨å¯ç”¨åŒºéƒ¨ç½²æ—¶ï¼Œé€šè¿‡RRé¿å…èŠ‚ç‚¹é—´ç›´æ¥BGPè¿æ¥</td></tr><tr><td><strong>etcd/K8s API</strong></td><td><code>calico-config</code> ConfigMap</td><td>- å­˜å‚¨<code>IPPools</code>ï¼ˆ<code>10.0.0.0/16</code>ï¼‰<br>- ä¿å­˜<code>BGPPeers</code>å’Œ<code>NetworkPolicy</code>å®šä¹‰</td><td><code>etcd_endpoints: &quot;https://etcd:2379&quot;</code> <br><code>useKubernetesAPI: true</code></td><td>æ‰€æœ‰ç»„ä»¶</td><td>ç®¡ç†å‘˜é€šè¿‡<code>calicoctl</code>åˆ›å»ºIPæ± æ—¶å†™å…¥etcd</td></tr><tr><td><strong>confd</strong></td><td><code>/etc/calico/confd</code></td><td>- ç›‘å¬etcd/K8s APIå˜æ›´ï¼ˆå¦‚<code>BGPPeer</code>æ›´æ–°ï¼‰<br>- åŠ¨æ€ç”ŸæˆBIRDé…ç½®å¹¶è§¦å‘é‡è½½</td><td><code>confd -watch -interval 10</code></td><td>BIRD, etcd</td><td>BGPå¯¹ç­‰èŠ‚ç‚¹IPå˜æ›´æ—¶ï¼Œè‡ªåŠ¨æ›´æ–°<code>bird.cfg</code>å¹¶æ‰§è¡Œ<code>birdc configure</code></td></tr><tr><td><strong>eBPF Dataplane</strong></td><td><code>bpfnat</code>, <code>bpfilter</code></td><td>- æ›¿æ¢kube-proxyå®ç°Serviceè´Ÿè½½å‡è¡¡<br>- é€šè¿‡eBPF mapåŠ é€Ÿç­–ç•¥åŒ¹é…ï¼ˆ<code>calico_prefilter</code>ï¼‰</td><td><code>bpfEnabled: true</code> <br><code>bpfExternalServiceMode: DSR</code></td><td>Linuxå†…æ ¸, Felix</td><td>é«˜æ€§èƒ½åœºæ™¯ä¸‹ï¼ŒServiceçš„DNATè§„åˆ™ç”±eBPFç¨‹åºå¤„ç†</td></tr><tr><td><strong>WireGuard</strong></td><td><code>wg-cali</code> (æ¥å£)</td><td>- åŠ å¯†èŠ‚ç‚¹é—´æµé‡ï¼ˆ<code>udp port 51820</code>ï¼‰<br>- æ”¯æŒPSKæˆ–è¯ä¹¦è®¤è¯</td><td><code>wireguardEnabled: true</code> <br><code>wireguardListeningPort: 51820</code></td><td>èŠ‚ç‚¹ç½‘ç»œæ ˆ</td><td>è·¨å…¬æœ‰äº‘éƒ¨ç½²æ—¶ï¼Œè‡ªåŠ¨å»ºç«‹åŠ å¯†éš§é“</td></tr></tbody></table><h2 id="_2-calicoä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_2-calicoä½¿ç”¨"><span><strong>2. Calicoä½¿ç”¨</strong></span></a></h2><h3 id="_1-setup-kindé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_1-setup-kindé›†ç¾¤"><span>1.setup kindé›†ç¾¤</span></a></h3><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Cluster</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">apiVersion:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> kind.x-k8s.io/v1alpha4</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">nodes:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> role:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> control-plane</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> role:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> worker</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> role:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> worker</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">networking:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  disableDefaultCNI:</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  podSubnet:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 192.168.0.0/16</span></span></code></pre></div><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cluster</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name=calico-cluster</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --config=config.yaml</span></span></code></pre></div><h3 id="_2-å®‰è£…calico" tabindex="-1"><a class="header-anchor" href="#_2-å®‰è£…calico"><span>2. å®‰è£…calico</span></a></h3><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://raw.githubusercontent.com/projectcalico/calico/v3.30.2/manifests/tigera-operator.yaml</span></span></code></pre></div><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://raw.githubusercontent.com/projectcalico/calico/v3.30.2/manifests/custom-resources.yaml</span></span></code></pre></div><h3 id="_3-æŸ¥çœ‹webé¡µé¢" tabindex="-1"><a class="header-anchor" href="#_3-æŸ¥çœ‹webé¡µé¢"><span>3. æŸ¥çœ‹webé¡µé¢</span></a></h3><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> port-forward</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -n</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> calico-system</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> service/whisker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 8081:8081</span></span></code></pre></div><h3 id="_4-å®‰è£…nginxæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-å®‰è£…nginxæµ‹è¯•"><span>4. å®‰è£…nginxæµ‹è¯•</span></a></h3><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> namespace</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> quickstart</span></span></code></pre></div><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> deployment</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --namespace=quickstart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --image=nginx</span></span></code></pre></div><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> expose</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --namespace=quickstart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> deployment</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nginx</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --port=80</span></span></code></pre></div><p>å®‰è£…å¹¶æš´éœ²æœåŠ¡æˆåŠŸä¹‹åï¼Œåˆ›å»ºbusyboxå®¹å™¨å¹¶å¯¹nginx podè¿›è¡Œè®¿é—®</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --namespace=quickstart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> access</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --rm</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -ti</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --image</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> busybox</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /bin/sh</span></span></code></pre></div><p>æ­¤æ—¶ï¼Œé€šè¿‡podç½‘ç»œè®¿é—®é›†ç¾¤å†…nginxå’Œè®¿é—®å¤–ç½‘éƒ½èƒ½æˆåŠŸ</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">wget</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -qO-</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> http://nginx</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">wget</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -qO-</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://docs.tigera.io/pod-connection-test.txt</span></span></code></pre></div><h3 id="_5-é€šè¿‡calicoå¯¹ç½‘ç»œåŠ ä¸€äº›é™åˆ¶" tabindex="-1"><a class="header-anchor" href="#_5-é€šè¿‡calicoå¯¹ç½‘ç»œåŠ ä¸€äº›é™åˆ¶"><span>5. é€šè¿‡calicoå¯¹ç½‘ç»œåŠ ä¸€äº›é™åˆ¶</span></a></h3><p>å¯¹è¿›ingresså’Œegresséƒ½è¿›è¡Œé™åˆ¶</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> -</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;&lt;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">EOF</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">apiVersion: projectcalico.org/v3</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">kind: GlobalNetworkPolicy</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  name: default-deny</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">spec:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  selector: projectcalico.org/namespace not in {&#39;kube-system&#39;, &#39;calico-system&#39;, &#39;calico-apiserver&#39;}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  types:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    - Ingress</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    - Egress</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">EOF</span></span></code></pre></div><p>åœ¨è¿›è¡Œç½‘ç»œé™åˆ¶ä¹‹åï¼Œè®¿é—®nginxå’Œå¤–ç½‘éƒ½ä¼šå¤±è´¥ã€‚</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">wget</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -qO-</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> http://nginx</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">wget</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -qO-</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://docs.tigera.io/pod-connection-test.txt</span></span></code></pre></div><h3 id="_5-æŠŠç½‘ç»œæ”¾å¼€ä¸€ç‚¹" tabindex="-1"><a class="header-anchor" href="#_5-æŠŠç½‘ç»œæ”¾å¼€ä¸€ç‚¹"><span>5. æŠŠç½‘ç»œæ”¾å¼€ä¸€ç‚¹</span></a></h3><p>æŠŠegressæ”¾å¼€</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> -</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;&lt;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">EOF</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">apiVersion: projectcalico.org/v3</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">kind: NetworkPolicy</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  name: allow-busybox-egress</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  namespace: quickstart</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">spec:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  selector: run == &#39;access&#39;</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  types:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  - Egress</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  egress:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  - action: Allow</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">EOF</span></span></code></pre></div><p>æ­¤æ—¶è®¿é—®å¤–ç½‘å¯ä»¥æˆåŠŸï¼Œä½†æ˜¯è®¿é—®nginxä¾æ—§å¤±è´¥ã€‚</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">wget</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -qO-</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://docs.tigera.io/pod-connection-test.txt</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">wget</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -qO-</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> http://nginx</span></span></code></pre></div><p>æŠŠnginxçš„ingressæ‰“å¼€</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kubectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> -</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> &lt;&lt;</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">EOF</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">apiVersion: projectcalico.org/v3</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">kind: NetworkPolicy</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  name: allow-nginx-ingress</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  namespace: quickstart</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">spec:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  selector: app == &#39;nginx&#39;</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  types:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  - Ingress</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  ingress:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  - action: Allow</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">    source:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">      selector: run == &#39;access&#39;</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">EOF</span></span></code></pre></div><p>æ­¤æ—¶è®¿é—®nginxå³å¯æˆåŠŸ</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">wget</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -qO-</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> http://nginx</span></span></code></pre></div><h3 id="_6-æ¸…ç†" tabindex="-1"><a class="header-anchor" href="#_6-æ¸…ç†"><span>6. æ¸…ç†</span></a></h3><div class="language-bash" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">kind</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> delete</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cluster</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --name</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> calico-cluster</span></span></code></pre></div>`,39)]))}const p=i(n,[["render",l]]),c=JSON.parse('{"path":"/k8s/ayl6l9u6/","title":"ğŸ±Calicoæ¶æ„å’Œä½¿ç”¨","lang":"zh-CN","frontmatter":{"title":"ğŸ±Calicoæ¶æ„å’Œä½¿ç”¨","createTime":"2025/08/03 18:03:36","permalink":"/k8s/ayl6l9u6/","description":"åœ¨ Calicoï¼ˆæˆ–åŸºäº BGP çš„ç½‘ç»œæ¶æ„ï¼‰ä¸­ï¼Œè·¯ç”±å®£å‘Šçš„è§¦å‘æ¡ä»¶ä¸ç½‘ç»œæ‹“æ‰‘å˜åŒ–ã€ç­–ç•¥è°ƒæ•´æˆ–ç³»ç»Ÿäº‹ä»¶å¯†åˆ‡ç›¸å…³ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åœºæ™¯åˆ†æåŠè§¦å‘æœºåˆ¶ï¼š 1. Calicoæ¶æ„å›¾ 2. Calicoä½¿ç”¨ 1.setup kindé›†ç¾¤ 2. å®‰è£…calico 3. æŸ¥çœ‹webé¡µé¢ 4. å®‰è£…nginxæµ‹è¯• å®‰è£…å¹¶æš´éœ²æœåŠ¡æˆåŠŸä¹‹åï¼Œåˆ›å»ºbusyboxå®¹å™¨å¹¶å¯¹ngin...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ğŸ±Calicoæ¶æ„å’Œä½¿ç”¨\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-08-13T15:11:46.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://blog.jianzhihao.icu/k8s/ayl6l9u6/"}],["meta",{"property":"og:site_name","content":"ZH Blog"}],["meta",{"property":"og:title","content":"ğŸ±Calicoæ¶æ„å’Œä½¿ç”¨"}],["meta",{"property":"og:description","content":"åœ¨ Calicoï¼ˆæˆ–åŸºäº BGP çš„ç½‘ç»œæ¶æ„ï¼‰ä¸­ï¼Œè·¯ç”±å®£å‘Šçš„è§¦å‘æ¡ä»¶ä¸ç½‘ç»œæ‹“æ‰‘å˜åŒ–ã€ç­–ç•¥è°ƒæ•´æˆ–ç³»ç»Ÿäº‹ä»¶å¯†åˆ‡ç›¸å…³ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åœºæ™¯åˆ†æåŠè§¦å‘æœºåˆ¶ï¼š 1. Calicoæ¶æ„å›¾ 2. Calicoä½¿ç”¨ 1.setup kindé›†ç¾¤ 2. å®‰è£…calico 3. æŸ¥çœ‹webé¡µé¢ 4. å®‰è£…nginxæµ‹è¯• å®‰è£…å¹¶æš´éœ²æœåŠ¡æˆåŠŸä¹‹åï¼Œåˆ›å»ºbusyboxå®¹å™¨å¹¶å¯¹ngin..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-13T15:11:46.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-13T15:11:46.000Z"}]]},"readingTime":{"minutes":3.44,"words":1033},"git":{"createdTime":1755097906000,"updatedTime":1755097906000,"contributors":[{"name":"zhihao","username":"zhihao","email":"mac@zhihaomac.local","commits":1,"avatar":"https://avatars.githubusercontent.com/zhihao?v=4","url":"https://github.com/zhihao"}],"changelog":[{"hash":"b14e6181535ae1948c566c3579bb41b2ebd924aa","time":1755097906000,"email":"mac@zhihaomac.local","author":"zhihao","message":"add calico"}]},"autoDesc":true,"filePathRelative":"notes/k8s/2. ç½‘ç»œ/Calico/2.Calicoæ¶æ„å’Œä½¿ç”¨.md","headers":[]}');export{p as comp,c as data};
