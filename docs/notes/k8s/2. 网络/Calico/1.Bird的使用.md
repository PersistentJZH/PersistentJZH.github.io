---
title: 'ğŸ¦â€ğŸ”¥Birdçš„ä½¿ç”¨'
createTime: 2025/08/13 16:37:20
permalink: /k8s/eigpt0xy/
---
ä»¥ä¸‹æ˜¯åœ¨ **Multipass** ä¸­åˆ›å»ºä¸¤å° Ubuntu è™šæ‹Ÿæœºï¼Œå¹¶é€šè¿‡ **BIRD** å®ç° BGP è·¯ç”±äº¤æ¢çš„å®Œæ•´æ¼”ç¤ºæ­¥éª¤ï¼š

---

### **1. åˆ›å»ºä¸¤å°è™šæ‹Ÿæœº**
```bash
multipass launch --name vm1 --cpus 1 --mem 1G --disk 5G
multipass launch --name vm2 --cpus 1 --mem 1G --disk 5G
```

### **2. å®‰è£… BIRD**
åœ¨ä¸¤å°è™šæ‹Ÿæœºä¸Šå®‰è£… BIRDï¼ˆBGP è·¯ç”±å®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼š
```bash
# è¿›å…¥ vm1
multipass shell vm1
sudo apt update
sudo apt install -y bird
```

åŒæ ·åœ¨ `vm2` ä¸Šæ‰§è¡Œç›¸åŒæ“ä½œã€‚

---

### **3. é…ç½® BGP**
#### **åœ¨ vm1 ä¸Šé…ç½® BIRDï¼ˆAS 65001ï¼‰**
ç¼–è¾‘é…ç½®æ–‡ä»¶ `/etc/bird/bird.conf`ï¼š
```bash
sudo nano /etc/bird/bird.conf
```
å†…å®¹å¦‚ä¸‹ï¼š
```conf
router id 192.168.64.100;  # ä½¿ç”¨ vm1 çš„ IP

protocol kernel {
    scan time 60;
    import filter {
        if (net = 0.0.0.0/0) then reject;
        accept;
    };
    export all;
}

protocol device {
    scan time 60;
}

protocol bgp vm2 {
    local as 65001;
    neighbor 192.168.64.101 as 65002;  # vm2 çš„ IP å’Œ AS
    import all;
    export all;
}
```

#### **åœ¨ vm2 ä¸Šé…ç½® BIRDï¼ˆAS 65002ï¼‰**
ç¼–è¾‘ `/etc/bird/bird.conf`ï¼š
```conf
router id 192.168.64.101;  # ä½¿ç”¨ vm2 çš„ IP

protocol kernel {
    scan time 60;
    import filter {
        if (net = 0.0.0.0/0) then reject;
        accept;
    };
    export all;
}

protocol device {
    scan time 60;
}

protocol bgp vm1 {
    local as 65002;
    neighbor 192.168.64.100 as 65001;  # vm1 çš„ IP å’Œ AS
    import all;
    export all;
}
```

---

### **4. å¯åŠ¨ BIRD å¹¶éªŒè¯**
#### **åœ¨ä¸¤å°è™šæ‹Ÿæœºä¸Šé‡å¯ BIRDï¼š**
```bash
sudo systemctl restart bird
sudo systemctl enable bird
```

#### **æ£€æŸ¥ BGP é‚»å±…çŠ¶æ€ï¼š**
```bash
birdc show protocols
```
è¾“å‡ºåº”æ˜¾ç¤º `vm2` æˆ– `vm1` ä¸º `Established` çŠ¶æ€ã€‚

#### **æµ‹è¯•è¿é€šæ€§ï¼š**
åœ¨ `vm1` ä¸Šæ·»åŠ ä¸€ä¸ªæµ‹è¯•è·¯ç”±å¹¶æ£€æŸ¥ `vm2` æ˜¯å¦å­¦ä¹ åˆ°ï¼š
```bash
# åœ¨ vm1 ä¸Šæ·»åŠ æµ‹è¯•è·¯ç”±
sudo ip route add 10.0.0.0/24 via 192.168.64.100

# åœ¨ vm2 ä¸Šæ£€æŸ¥è·¯ç”±è¡¨
ip route | grep 10.0.0.0
```

---

### **5. å…³é”®é—®é¢˜æ’æŸ¥**
- **BGP é‚»å±…æœªå»ºç«‹**ï¼š  
  æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦æ”¾è¡Œ BGP ç«¯å£ï¼ˆTCP 179ï¼‰ï¼š
  ```bash
  sudo ufw allow 179/tcp
  ```
- **è·¯ç”±æœªåŒæ­¥**ï¼š  
  ç¡®ä¿ `protocol kernel` ä¸­é…ç½®äº† `export all`ã€‚

---

### **æ•ˆæœå›¾**
```
vm1 (AS65001) â†” BGP â†” vm2 (AS65002)
  192.168.64.100     192.168.64.101
```

é€šè¿‡æ­¤é…ç½®ï¼Œä¸¤å°è™šæ‹Ÿæœºå°†é€šè¿‡ BGP åŠ¨æ€äº¤æ¢è·¯ç”±è¡¨ã€‚ä½ å¯ä»¥æ‰©å±•æ­¤å®éªŒï¼ˆå¦‚æ·»åŠ  OSPF æˆ–æ›´å¤šé‚»å±…ï¼‰ã€‚

ä¹Ÿå¯ç›´æ¥å‚è€ƒå®˜æ–¹dockeræ¼”ç¤ºï¼šhttps://packetfire.org/post/intro-to-bgp/