---
title: ' calico'
createTime: 2025/08/12 22:03:59
permalink: /k8s/1q63pwfs/
---

kind create cluster --name calico-cluster --config - <<EOF
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
- role: worker
- role: worker
networking:
  disableDefaultCNI: true
  podSubnet: 192.167.0.0/16
EOF

kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.30.2/manifests/tigera-operator.yaml

kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.30.2/manifests/custom-resources.yaml


cat <<EOF | calicoctl apply -f - 
---
apiVersion: projectcalico.org/v3
kind: IPPool
metadata:
  name: external-pool
spec:
  cidr: 192.168.64.0/24
  blockSize: 29
  ipipMode: Never
  natOutgoing: true
  nodeSelector: "!all()"
EOF



multipass set local.bridged-network.range=10.168.64.0/24



cat <<EOF | calicoctl apply -f -
---
apiVersion: projectcalico.org/v3
kind: BGPPeer
metadata:
  name: bgppeer-global-host1
spec:
  peerIP: 192.168.64.5
  asNumber: 64512
EOF




sudo bash -c "cat > /etc/bird/bird.conf <<EOF
router id 192.168.64.6;

protocol kernel {
    scan time 60;
    import none;
    export all;
}

protocol device {
    scan time 60;
}

protocol bgp k8s_calico {
    local as 64512;
    neighbor 172.18.0.3 as 64511;  # 将指向Kind节点的IP
    import all;
    export none;
    multihop;
}
EOF"


kubectl apply -f - <<EOF
apiVersion: projectcalico.org/v3
kind: BGPPeer
metadata:
  name: multipass-peer
spec:
  peerIP: 192.168.64.6
  asNumber: 64512
  nodeSelector: all()
EOF